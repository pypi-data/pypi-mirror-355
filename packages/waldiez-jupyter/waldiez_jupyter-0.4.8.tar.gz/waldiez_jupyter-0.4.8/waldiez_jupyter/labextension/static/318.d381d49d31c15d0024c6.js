"use strict";(self.webpackChunk_waldiez_jupyter=self.webpackChunk_waldiez_jupyter||[]).push([[318],{8318:(e,t,n)=>{n.r(t),n.d(t,{default:()=>j});const s="@waldiez/jupyter",i=`${s}:plugin`,r="Waldiez editor",o="waldiez";var a;!function(e){e.PLUGIN_DESCRIPTION="Waldiez JupyterLab extension.",e.WALDIEZ_FILE="Waldiez File",e.NEW_WALDIEZ_FILE="New Waldiez File",e.CAPTION="Create a new Waldiez file",e.TO_PYTHON="To python",e.TO_PYTHON_CAPTION="Export .waldiez to .py",e.TO_JUPYTER="To notebook",e.TO_JUPYTER_CAPTION="Export .waldiez to .ipynb",e.OPEN_WALDIEZ="Open Waldiez",e.ON_EMPTY_PROMPT="Enter your message to start the chat:",e.LOG_CONSOLE="Log Console",e.SHOW_LOGS="Show logs",e.CLEAR_LOGS="Clear Logs",e.HIDE_LOGS="Hide logs",e.RESTART_KERNEL="Restart kernel",e.INTERRUPT_KERNEL="Interrupt kernel",e.KERNEL_INTERRUPTED="Kernel interrupted",e.KERNEL_RESTARTED="Kernel restarted",e.SHUTDOWN_KERNEL="Shutdown kernel",e.CHANGE_KERNEL="Change kernel",e.RECONNECT_TO_KERNEL="Reconnect to kernel",e.LOGGER_INITIALIZED="Waldiez logger initialized",e.AFTER_INSTALL_NOTE="NOTE: If new packages were added and you are using Jupyter, you might need to restart the kernel.",e.NO_KERNEL="No kernel",e.NO_KERNEL_MESSAGE="Please start a kernel before running the workflow.",e.KERNEL_STATUS_CHANGED=e=>`Kernel status changed to ${e}`}(a||(a={}));var l=n(484),d=n(8244);const c=new l.LabIcon({name:"waldiez:icon/logo",svgstr:d});var u=n(1689),h=n(186);const g=async(e,t)=>{const n=[],s=e.tracker.currentWidget?.selectedItems();if(s)for(const e of s)e.name.endsWith(".waldiez")&&n.push(e.path);n.length>0&&await _(n,t)},_=async(e,t)=>{const n=h.ServerConnection.makeSettings(),s=u.URLExt.join(n.baseUrl,"waldiez","files");let i;try{i=await h.ServerConnection.makeRequest(s,{body:JSON.stringify({files:e,extension:t}),method:"POST"},n)}catch(e){throw new h.ServerConnection.NetworkError(e)}const r=await i.text();if(r.length>0)try{JSON.parse(r)}catch(e){console.log("Not a JSON response body.",i)}if(!i.ok)throw new h.ServerConnection.ResponseError(i,r.message||r)};var m,p=n(9560);!function(e){e.createNew="waldiez:create-new",e.openWaldiez="waldiez:open-waldiez",e.clearLogs="waldiez:clear-logs",e.toggleLogsView="waldiez:toggle-logs-view",e.interruptKernel="waldiez:interrupt-kernel",e.reconnectToKernel="waldiez:reconnect-to-kernel",e.shutdownKernel="waldiez:shutdown-kernel",e.restartKernel="waldiez:restart-kernel",e.changeKernel="waldiez:change-kernel",e.exportToPython="waldiez:to-py",e.exportToJupyter="waldiez:to-ipynb"}(m||(m={}));const b=(e,t)=>null!==t.currentWidget&&t.currentWidget===e.shell.currentWidget;var w=n(2458);class f{constructor(e){Object.defineProperty(this,"_commands",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_panel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_rendermime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_loggerRegistry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_logConsole",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_widget",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_toggleConsoleViewButton",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_widgetIsVisible",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_toggleConsoleViewCommandId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_logConsoleClearCommandId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._id=e.editorId,this._commands=e.commands,this._rendermime=e.rendermime,this._logConsoleClearCommandId=`${m.clearLogs}-${this._id}`,this._toggleConsoleViewCommandId=`${m.toggleLogsView}-${this._id}`,this._loggerRegistry=new w.LoggerRegistry({defaultRendermime:this._rendermime,maxLength:1e3}),this._logConsole=new w.LogConsolePanel(this._loggerRegistry),this._logConsole.id=`waldiez-log-console-${this._id}`,this._logConsole.title.label=a.LOG_CONSOLE,this._logConsole.source=`Waldiez-${this._id}`,this._widgetIsVisible=!1,this._toggleConsoleViewButton=new l.CommandToolbarButton({commands:this._commands,id:this._toggleConsoleViewCommandId,icon:l.consoleIcon,label:()=>this._widgetIsVisible?` ${a.HIDE_LOGS}`:` ${a.SHOW_LOGS}`}),this._panel=e.panel,this._widget=this._getLogWidget(),this._getLogger().level="info"}get toggleConsoleViewButton(){return this._toggleConsoleViewButton}get isVisible(){return this._widgetIsVisible}get widget(){return this._widget}_remove_ansi(e){return e.replace(/\u001b\[[\x20-\x3f]*[\x40-\x7e]/g,"")}log(e){if("string"!=typeof e){if("level"in e)this._logData(e);else{if(!("object"!=typeof e||e&&"header"in e))return void this._logData({data:JSON.stringify(e),level:"info",type:"text"});"error"===e.header.msg_type?(this._logData({data:e.content.ename,level:"error",type:"text"}),this._logData({data:e.content.evalue,level:"error",type:"text"}),this._logData({data:e.content.traceback.join("\n"),level:"error",type:"text"})):"stream"===e.header.msg_type?this._logIOPub(e):"input_request"===e.header.msg_type?this._logStdin(e):"execute_reply"===e.header.msg_type?this._logReply(e):"execute_request"===e.header.msg_type&&this._logExecuteRequest(e)}this._scrollToBottom()}else this._logData({data:e,level:"info",type:"text"})}toggle(){this._widgetIsVisible?this._widget.hide():this._widget.show(),this._panel.contains(this._widget)||this._panel.addWidget(this._widget),this._panel.setRelativeSizes([4,1]),this._widgetIsVisible=!this._widgetIsVisible,this._toggleConsoleViewButton.update()}clear(){this._getLogger().clear()}dispose(){this._logConsole.dispose();for(const e of[this._toggleConsoleViewCommandId,this._logConsoleClearCommandId])this._commands.hasCommand(e)&&this._commands.notifyCommandChanged(e)}_scrollToBottom(e=0){const t=this._logConsole.node.querySelectorAll(".jp-OutputArea-child");if(!t)return e<5?void setTimeout((()=>this._scrollToBottom(e+1)),1e3):void 0;const n=t[t.length-1];n&&n.scrollIntoView()}_getLogWidget(){const e=new p.MainAreaWidget({content:this._logConsole});return e.toolbar.addItem("clear",new l.CommandToolbarButton({commands:this._commands,id:this._logConsoleClearCommandId})),this._commands.hasCommand(this._logConsoleClearCommandId)||this._commands.addCommand(this._logConsoleClearCommandId,{execute:()=>this._getLogger().clear(),isEnabled:()=>!!this._logConsole&&null!==this._logConsole.source,label:` ${a.CLEAR_LOGS}`,icon:l.clearIcon}),this._commands.hasCommand(this._toggleConsoleViewCommandId)||this._commands.addCommand(this._toggleConsoleViewCommandId,{execute:this.toggle.bind(this)}),e}_logIOPub(e){const t=e.content;if("stdout"===t.name||"stderr"===t.name){let e="info";const n=t.text,s=n.toLowerCase();"stderr"===t.name&&(!s.includes("warning")||s.includes("error")&&!s.includes("exception")||(e="warning"));const i={data:n,level:e,type:"text"};this._logData(i)}}_logStdin(e){const t={data:e.content.prompt,level:"warning",type:"text"};this._logData(t)}_logReply(e){const t={data:e.content.status,level:"info",type:"text"};this._logData(t)}_logExecuteRequest(e){const t={data:e.content.code,level:"info",type:"text"};this._logData(t)}_logData(e){const t="string"==typeof e.data?this._remove_ansi(e.data):this._remove_ansi(JSON.stringify(e.data));e.data=t,this._getLogger().log(e)}_getLogger(){return this._loggerRegistry.getLogger(`Waldiez-${this._id}`)}}var v=n(3874);class y{constructor({logger:e,onStdin:t,baseUrl:n,onInputRequest:s,onMessagesUpdate:i,onEnd:r}){Object.defineProperty(this,"_running",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_future",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_onStdin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_logger",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_messages",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_userParticipants",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_onInputRequest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_onMessagesUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_onEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_requestId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_expectingUserInput",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_uploadsRoot",{enumerable:!0,configurable:!0,writable:!0,value:null}),this._logger=e,this._onStdin=t,this._baseUrl=n,this._onMessagesUpdate=i,this._onInputRequest=s,this._onEnd=r}get running(){return this._running}run(e,t){if(this._running)return void console.warn("A waldiez file is already running");this._running=!0,this._messages=[],this._userParticipants=[],this._uploadsRoot=(e=>{const t=e.includes("\\")?"\\":"/",n=e.lastIndexOf(t);return(-1!==n?e.substring(0,n):".")+t+"uploads"})(t);const n=(e=>`from pathlib import Path\nfrom autogen.io import IOStream\nfrom waldiez import WaldiezRunner\nfrom waldiez.io import StructuredIOStream\n\nfile_path = Path(r"${e}").as_posix()\nuploads_root = Path(file_path).parent / "uploads"\nstream = StructuredIOStream(uploads_root=uploads_root)\nwith IOStream.set_default(stream):\n    runner = WaldiezRunner.load(waldiez_file=file_path)\n    runner.run(uploads_root=uploads_root)\n`)(t);this._future=e.requestExecute({code:n,stop_on_error:!0},!1),this._onFuture()}reset(){this._running=!1,this._future=void 0,this._messages=[],this._userParticipants=[],this._requestId=null,this._expectingUserInput=!1,this._onMessagesUpdate(!1)}getPreviousMessages(){return this._messages}getUserParticipants(){return this._userParticipants}_onFuture(){if(!this._future)return console.error("Failed to create a future for the waldiez file"),void this.reset();this._future.onStdin=e=>{const t=e;t.metadata={request_id:this._requestId},this._onStdin(t),this._expectingUserInput=!0},this._future.onIOPub=e=>{const t=e.header.msg_type;if("stream"===t){const t=e;"stdout"===t.content.name&&this._processMessage(t.content.text),this._logger.log(t)}else"error"===t&&this._logger.log(e)},this._future.onReply=e=>{"ok"!==e.content.status&&this._logger.log(`error: ${e}`)},this._future.done.catch((e=>{console.error("Error while running the waldiez file",e),e||(e={channel:"iopub",content:{name:"stderr",text:"Failed to run the waldiez file"},header:{msg_type:"stream"},metadata:{}}),this._logger.log(e)})).finally((()=>{this.reset()}))}_processMessage(e){if(!this._running)return;const t=this._requestId?u.URLExt.join(this._baseUrl,"waldiez","files")+`?view=${this._uploadsRoot}/${this._requestId}.png`:void 0,n=v.WaldiezChatMessageProcessor.process(e,this._requestId,t);n&&(this._expectingUserInput&&n.message&&"text"===n.message.type&&n.message.sender&&(this._expectingUserInput=!1),n.message&&"input_request"===n.message.type&&n.requestId&&(this._requestId=n.requestId,this._onInputRequest(n.requestId),this._expectingUserInput=!0),n.message&&n.message.content&&(this._messages.push(n.message),this._onMessagesUpdate(this._expectingUserInput)),n.isWorkflowEnd&&(this._running=!1,this._onEnd(),this._logger.log("Workflow finished")),n.participants&&n.participants.users.length>0&&(this._userParticipants=Array.from(new Set([...this._userParticipants,...n.participants.users]))))}}var I=n(4848);n(2794);class C extends l.ReactWidget{constructor(e){super(),Object.defineProperty(this,"_chat",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_waldiez",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.addClass("jp-waldiez-widget"),this._chat=e.chat;const t=(0,v.importFlow)(e.jsonData);this._waldiez={...t,flowId:e.flowId,storageId:t.storageId??e.flowId,onChange:e.onChange,onRun:e.onRun,onUpload:e.onUpload,monacoVsPath:e.vsPath}}render(){return(0,I.jsx)(l.UseSignal,{signal:this._chat,initialArgs:null,children:(e,t)=>(0,I.jsx)(v.Waldiez,{...this._waldiez,chat:null!==t?t:void 0})})}}var E=n(4375),R=n(4602);class O extends E.DocumentWidget{constructor(e){super(e),Object.defineProperty(this,"_commands",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_settingsRegistry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_inputRequestId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_stdinRequest",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_chat",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_logger",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_runner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_restartKernelCommandId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_interruptKernelCommandId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_restartKernelButton",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_interruptKernelButton",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serverSettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._commands=e.commands,this._settingsRegistry=e.settingregistry,this._chat=new R.Signal(this),this._logger=new f({commands:this._commands,editorId:this.id,panel:this.content,rendermime:e.rendermime}),this._restartKernelCommandId=`${m.restartKernel}-${this.id}`,this._interruptKernelCommandId=`${m.interruptKernel}-${this.id}`,this._restartKernelButton=new l.CommandToolbarButton({commands:this._commands,id:this._restartKernelCommandId,icon:l.kernelIcon,label:` ${a.RESTART_KERNEL}`}),this._interruptKernelButton=new l.CommandToolbarButton({commands:this._commands,id:this._interruptKernelCommandId,icon:l.kernelIcon,label:` ${a.INTERRUPT_KERNEL}`}),this.toolbar.addItem("toggle-logs-view",this._logger.toggleConsoleViewButton),this.toolbar.addItem("clear-logs",this._interruptKernelButton),this.toolbar.addItem("restart-kernel",this._restartKernelButton),this._serverSettings=h.ServerConnection.makeSettings(),this._runner=new y({logger:this._logger,baseUrl:this._serverSettings.baseUrl,onInputRequest:this._onInputRequest.bind(this),onStdin:this._onStdin.bind(this),onMessagesUpdate:this._onMessagesUpdate.bind(this),onEnd:this._onEnd.bind(this)}),this.context.ready.then(this._onContextReady.bind(this)),this.context.sessionContext.statusChanged.connect(this._onSessionStatusChanged,this),this._initCommands()}dispose(){super.dispose(),this.content.dispose(),this._logger.dispose(),this._restartKernelButton.dispose(),this._commands.hasCommand(this._restartKernelCommandId)&&this._commands.notifyCommandChanged(this._restartKernelCommandId),this._interruptKernelButton.dispose(),this._commands.hasCommand(this._interruptKernelCommandId)&&this._commands.notifyCommandChanged(this._interruptKernelCommandId),this._runner.reset()}_onSessionStatusChanged(e,t){this._logger.log({data:a.KERNEL_STATUS_CHANGED(t),level:"debug",type:"text"})}_onContextReady(){this._getServeMonacoSetting().then((e=>{const t=this._getWaldiezWidget(e||void 0);this.content.addWidget(t);const n={data:a.LOGGER_INITIALIZED,level:"info",type:"text"};this._logger.log(n)}))}_initCommands(){this._commands.hasCommand(this._restartKernelCommandId)||this._commands.addCommand(this._restartKernelCommandId,{execute:this._onRestartKernel.bind(this),label:` ${a.RESTART_KERNEL}`}),this._commands.hasCommand(this._interruptKernelCommandId)||this._commands.addCommand(this._interruptKernelCommandId,{execute:this._onInterruptKernel.bind(this),label:` ${a.INTERRUPT_KERNEL}`})}_onRestartKernel(){const e=this.context.sessionContext.session;e?.kernel&&e.kernel.restart()}_onInterruptKernel(){const e=this.context.sessionContext.session;e?.kernel&&e.kernel.interrupt()}_onContentChanged(e){e!==this.context.model.toString()&&(this.context.model.fromString(e),this.context.model.dirty=!0)}_getServeMonacoSetting(){return new Promise((e=>{this._settingsRegistry.get(i,"serve_monaco").then((t=>{if(t.composite){let t=this._serverSettings.baseUrl.replace(/https?:\/\/[^/]+/,"");t.endsWith("/")||(t+="/"),e(`${t}static/vs`)}else e(null)})).catch((t=>{console.error(t),e(null)}))}))}onUpload(e){return new Promise((t=>{const n=[],s=e.map((async e=>{try{const t=await(async e=>{const t=h.ServerConnection.makeSettings(),n=u.URLExt.join(t.baseUrl,"waldiez","upload");let s;try{const i=new FormData;i.append("file",e),s=await h.ServerConnection.makeRequest(n,{body:i,method:"POST"},t)}catch(e){throw new h.ServerConnection.NetworkError(e)}const i=await s.text();if(i.length>0)try{JSON.parse(i)}catch(e){throw new Error("Not a JSON response body.")}let r;if(!s.ok)throw new h.ServerConnection.ResponseError(s,i.message||i);if(i.length>0)try{r=JSON.parse(i)}catch(e){throw new Error("Not a JSON response body.")}return r.path})(e);n.push(t)}catch(e){let t="Unknown error";e instanceof Error&&(t=e.message),"string"==typeof e&&(t=e),"function"==typeof e.toString&&(t=e.toString()),"string"==typeof e.message&&(t=e.message),"object"==typeof e&&null!==e&&(t=JSON.stringify(e)),this._logger.log({data:t,level:"error",type:"text"})}}));Promise.all(s).then((()=>{t(n)}))}))}_askForInput(){const e=this._runner.getPreviousMessages();let t="<unknown>";t="string"==typeof this._stdinRequest?.metadata.request_id?this._stdinRequest.metadata.request_id:this._inputRequestId??this._getRequestIdFromPreviousMessages(e);const n={showUI:!0,messages:e,userParticipants:this._runner.getUserParticipants(),activeRequest:{request_id:t,prompt:this._stdinRequest?.content.prompt??"> ",password:this._stdinRequest?.content.password??!1},handlers:{onUserInput:this._onUserInput.bind(this),onInterrupt:this._handleInterrupt.bind(this)}};this._chat.emit(n)}_handleInterrupt(){this._stdinRequest=null,this._inputRequestId=null,this._runner.reset(),this._chat.emit({showUI:!1,messages:[],userParticipants:[],activeRequest:void 0}),this._onInterruptKernel()}_getWaldiezWidget(e){const t=this.context.model.toString();let n={};try{n=JSON.parse(t)}catch(e){}return new C({flowId:this.id,jsonData:n,vsPath:e,chat:this._chat,onChange:this._onContentChanged.bind(this),onRun:this._onRun.bind(this),onUpload:this.onUpload})}_onStdin(e){let t=e.content.prompt;">"!==t&&"> "!==t||(t=a.ON_EMPTY_PROMPT),this._logger.log({data:t,level:"warning",type:"text"}),this._stdinRequest=e,this._askForInput()}_onInputRequest(e){this._inputRequestId=e}_onUserInput(e){this._stdinRequest&&(this._logger.log({data:JSON.stringify(e),level:"info",type:"text"}),this.context.sessionContext.session?.kernel?.sendInputReply({value:JSON.stringify(e),status:"ok"},this._stdinRequest.parent_header),this._stdinRequest=null)}_onRun(e){const t=this.context.sessionContext.session?.kernel;t?(this._logger.isVisible||this._logger.toggle(),this.context.model.dirty&&this.context.save(),(async e=>{const t=h.ServerConnection.makeSettings(),n=u.URLExt.join(t.baseUrl,"waldiez","files","?path="+e);let s;try{s=await h.ServerConnection.makeRequest(n,{method:"GET"},t)}catch(e){throw new h.ServerConnection.NetworkError(e)}const i=await s.text();let r;if(i.length>0)try{r=JSON.parse(i)}catch(e){throw new Error("Not a JSON response body.")}if(!s.ok)throw new h.ServerConnection.ResponseError(s,i.message||i);if(!r)throw new Error("No data returned from the server");return r.path})(this.context.path).then((e=>{this._runner.run(t,e)})).catch((e=>{this._logger.log({data:e,level:"error",type:"text"})}))):(0,p.showErrorMessage)(a.NO_KERNEL,a.NO_KERNEL_MESSAGE)}_onEnd(){this._chat.emit({showUI:!1,messages:this._runner.getPreviousMessages(),userParticipants:this._runner.getUserParticipants(),activeRequest:void 0})}_onMessagesUpdate(e){const t=this._runner.getPreviousMessages();this._chat.emit({showUI:t.length>0,messages:t,userParticipants:this._runner.getUserParticipants(),activeRequest:e?{request_id:this._inputRequestId??this._getRequestIdFromPreviousMessages(t),prompt:this._stdinRequest?.content.prompt??"> ",password:this._stdinRequest?.content.password??!1}:void 0,handlers:{onUserInput:this._onUserInput.bind(this),onInterrupt:this._handleInterrupt.bind(this)}})}_getRequestIdFromPreviousMessages(e){const t=e.find((e=>"input_request"===e.type));return t?t.request_id??"<unknown>":"<unknown>"}}var P=n(5256);class S extends E.ABCWidgetFactory{constructor(e){super(e),Object.defineProperty(this,"_commands",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_rendermime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_editorServices",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_settingRegistry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._commands=e.commands,this._rendermime=e.rendermime,this._editorServices=e.editorServices,this._settingRegistry=e.settingRegistry}get name(){return r}createNewWidget(e){const t=new P.SplitPanel({orientation:"vertical",alignment:"start",spacing:0});return t.title.label="Waldiez",t.title.closable=!0,new O({context:e,rendermime:this._rendermime,editorServices:this._editorServices,settingregistry:this._settingRegistry,content:t,commands:this._commands})}}var x=n(3549),N=n(3963),T=n(6313),L=n(8607),K=n(5577),k=n(1767),U=n(1542),z=n(4918);const j={id:i,description:a.PLUGIN_DESCRIPTION,autoStart:!0,requires:[k.IRenderMimeRegistry,N.IEditorServices,T.IFileBrowserFactory,U.ISettingRegistry],optional:[x.ILayoutRestorer,L.ILauncher,p.ICommandPalette,K.IMainMenu,z.ITranslator],activate:async(e,t,n,i,d,u,h,_,w,f)=>{console.log("JupyterLab extension waldiez is activated!");const v=s,y=new p.WidgetTracker({namespace:v}),I=new S({name:"Waldiez",fileTypes:[o],defaultFor:[o],canStartKernel:!0,preferKernel:!0,shutdownOnClose:!1,autoStartDefault:!0,commands:e.commands,translator:f,rendermime:t,editorServices:n,settingRegistry:d});return h&&h.add({command:m.createNew,category:"Other",rank:1}),_&&_.addItem({command:m.createNew,args:{isPalette:!0},category:r}),u&&u.restore(y,{command:m.openWaldiez,args:e=>({path:e.context.path,factory:r}),name:e=>e.context.path}),I.widgetCreated.connect(((t,n)=>{n.title.icon=c,n.context.pathChanged.connect((()=>{y.save(n)})),y.has(n)||y.add(n),n.isAttached||e.shell.add(n,"main"),e.shell.activateById(n.id)})),e.docRegistry.addFileType({name:o,displayName:a.WALDIEZ_FILE,contentType:"file",fileFormat:"json",extensions:[`.${o}`],mimeTypes:["application/json","text/json"],icon:c,iconLabel:"JupyterLab-Waldiez"}),e.docRegistry.addWidgetFactory(I),await(async(e,t,n,s,i,r)=>{const d=b.bind(null,e,t);((e,t,n,s,i,r)=>{const{commands:d}=e,u=n=>{const s=t.currentWidget;return!1!==n.activate&&s&&e.shell.activateById(s.id),s??null};d.addCommand(m.createNew,{label:e=>e.isPalette?a.NEW_WALDIEZ_FILE:a.WALDIEZ_FILE,caption:a.CAPTION,icon:c,execute:async t=>{const i=t.cwd||n.tracker.currentWidget?.model.path||"",r=await d.execute("docmanager:new-untitled",{path:i,type:"file",ext:`.${o}`});if(!r)return void console.error("Could not create a new .waldiez file");const a=await d.execute(m.openWaldiez,{cwd:i,path:r.path,factory:s.name});a&&(a.isAttached||e.shell.add(a,"main"),e.shell.activateById(a.id))}}),d.addCommand(m.openWaldiez,{label:a.OPEN_WALDIEZ,icon:c,execute:async t=>{const n=t.path,i=await e.commands.execute("docmanager:open",{path:n??`Untitled.${o}`,factory:s.name});i&&(i.isAttached||e.shell.add(i,"main"),e.shell.activateById(i.id))}}),d.addCommand(m.exportToPython,{label:a.TO_PYTHON,caption:a.TO_PYTHON_CAPTION,icon:l.pythonIcon,execute:async()=>g(n,"py")}),d.addCommand(m.exportToJupyter,{label:a.TO_JUPYTER,caption:a.TO_JUPYTER_CAPTION,icon:l.notebookIcon,execute:async()=>g(n,"ipynb")}),d.addCommand(m.interruptKernel,{label:a.INTERRUPT_KERNEL,execute:e=>{const t=u(e);if(!t)return;const n=t.context.sessionContext.session?.kernel;return n?n.interrupt():Promise.resolve(void 0)},isEnabled:i}),d.addCommand(m.restartKernel,{label:a.RESTART_KERNEL,execute:e=>{const t=u(e);if(!t)return;const n=t.context.sessionContext.session?.kernel;return n?n.restart():Promise.resolve(void 0)},isEnabled:i}),d.addCommand(m.changeKernel,{label:a.CHANGE_KERNEL,execute:e=>{const t=u(e);if(!t)return;const n=t.context.sessionContext;if(!n.session)return;const s=n.specsManager.specs?.kernelspecs;return s?new p.SessionContextDialogs({translator:r}).selectKernel(n):void 0},isEnabled:i}),d.addCommand(m.shutdownKernel,{label:a.SHUTDOWN_KERNEL,execute:e=>{const t=u(e);if(t)return t.context.sessionContext.shutdown()},isEnabled:i}),d.addCommand(m.reconnectToKernel,{label:a.RECONNECT_TO_KERNEL,execute:e=>{const t=u(e);if(!t)return;const n=t.context.sessionContext.session?.kernel;return n?n.reconnect():Promise.resolve(void 0)},isEnabled:i})})(e,t,n,s,d,r),i&&((e,t)=>{e.fileMenu.newMenu.addItem({command:m.createNew}),e.kernelMenu.kernelUsers.interruptKernel.add({id:m.interruptKernel,isEnabled:t}),e.kernelMenu.kernelUsers.reconnectToKernel.add({id:m.reconnectToKernel,isEnabled:t}),e.kernelMenu.kernelUsers.restartKernel.add({id:m.restartKernel,isEnabled:t}),e.kernelMenu.kernelUsers.shutdownKernel.add({id:m.shutdownKernel,isEnabled:t}),e.kernelMenu.kernelUsers.changeKernel.add({id:m.changeKernel,isEnabled:t})})(i,d)})(e,y,i,I,w,f),I}}}}]);