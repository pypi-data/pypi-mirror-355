Metadata-Version: 2.4
Name: fastapi-keystone
Version: 0.0.12
Summary: ğŸš€ åŸºäº FastAPI çš„ç°ä»£åŒ–å¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œæä¾›ä¼ä¸šçº§çš„å¤šç§Ÿæˆ·ã€ä¾èµ–æ³¨å…¥ã€è·¯ç”±ç®¡ç†ç­‰ç‰¹æ€§
Author-email: alpha <alphaqiu@gmail.com>
License-Expression: MIT
Project-URL: Homepage, https://github.com/alphaqiu/fastapi-keystone
Project-URL: Documentation, https://github.com/alphaqiu/fastapi-keystone#readme
Project-URL: Repository, https://github.com/alphaqiu/fastapi-keystone
Project-URL: Issues, https://github.com/alphaqiu/fastapi-keystone/issues
Project-URL: Changelog, https://github.com/alphaqiu/fastapi-keystone/releases
Keywords: fastapi,framework,mvc,async,orm
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: Framework :: FastAPI
Classifier: Topic :: Internet :: WWW/HTTP :: HTTP Servers
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Requires-Python: >=3.10
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: aiomysql>=0.2.0
Requires-Dist: aiosqlite>=0.21.0
Requires-Dist: asyncio>=3.4.3
Requires-Dist: asyncpg>=0.30.0
Requires-Dist: cachetools<7.0.0,>=6.0.0
Requires-Dist: fastapi>=0.115.12
Requires-Dist: injector>=0.22.0
Requires-Dist: pydantic<3.0.0,>=2.11.5
Requires-Dist: pydantic-settings>=2.9.1
Requires-Dist: python-ulid>=3.0.0
Requires-Dist: pyyaml>=6.0.2
Requires-Dist: redis<7.0.0,>=6.2.0
Requires-Dist: rich>=14.0.0
Requires-Dist: sqlalchemy>=2.0.41
Dynamic: license-file

# FastAPI Keystone

[![PyPI version](https://badge.fury.io/py/fastapi-keystone.svg?icon=si%3Apython)](https://badge.fury.io/py/fastapi-keystone)
[![Python Version](https://img.shields.io/pypi/pyversions/fastapi-keystone.svg)](https://pypi.org/project/fastapi-keystone/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

ğŸš€ **ä¸€ä¸ªåŸºäº FastAPI çš„è½»é‡çº§å¼€å‘æ¡†æ¶ï¼Œæä¾›ä¸€äº›å¸¸ç”¨çš„ä¼ä¸šçº§åŠŸèƒ½ç»„ä»¶ã€‚**

## é¡¹ç›®ç®€ä»‹

FastAPI Keystone æ˜¯ä¸€ä¸ªå›´ç»• FastAPI æ„å»ºçš„å¼€å‘æ¡†æ¶ï¼Œæ—¨åœ¨ç®€åŒ–å¸¸è§çš„ Web åº”ç”¨å¼€å‘ä»»åŠ¡ã€‚å®ƒæä¾›äº†ä¸€äº›å¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼Œå¦‚é…ç½®ç®¡ç†ã€è·¯ç”±è£…é¥°å™¨ã€æ ‡å‡†åŒ–å“åº”æ ¼å¼ã€ä¾èµ–æ³¨å…¥é›†æˆç­‰ã€‚

**æ³¨æ„ï¼š** æœ¬é¡¹ç›®ä»åœ¨å¼€å‘é˜¶æ®µï¼ŒAPI å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰ä»”ç»†è¯„ä¼°ã€‚

## æ ¸å¿ƒç‰¹æ€§

- **é…ç½®ç®¡ç†**ï¼šæ”¯æŒ JSON/YAML é…ç½®æ–‡ä»¶ï¼Œç¯å¢ƒå˜é‡è¦†ç›–
- **è·¯ç”±è£…é¥°å™¨**ï¼šåŸºäºç±»çš„è·¯ç”±å®šä¹‰æ–¹å¼
- **æ ‡å‡†åŒ–å“åº”**ï¼šç»Ÿä¸€çš„ API å“åº”æ ¼å¼
- **ä¾èµ–æ³¨å…¥**ï¼šä¸ injector åº“çš„é›†æˆ
- **ä¸­é—´ä»¶æ”¯æŒ**ï¼šå†…ç½®å¸¸ç”¨ä¸­é—´ä»¶ï¼ˆCORSã€GZIPã€å¼‚å¸¸å¤„ç†ç­‰ï¼‰
- **å¤šç§Ÿæˆ·æ”¯æŒ**ï¼šåŸºç¡€çš„å¤šæ•°æ®åº“é…ç½®ç®¡ç†
- **åˆ†é¡µæŸ¥è¯¢**ï¼šç®€å•çš„åˆ†é¡µæŸ¥è¯¢å·¥å…·

## å®‰è£…

```bash
pip install fastapi-keystone
```

### ä½¿ç”¨ uv (æ¨è)

```bash
uv add fastapi-keystone
```

## å¿«é€Ÿå¼€å§‹

### 1. åŸºç¡€ä½¿ç”¨

```python
import uvicorn
from fastapi_keystone.core.response import APIResponse
from fastapi_keystone.core.routing import Router, group
from fastapi_keystone.core.app import AppManager

# åˆ›å»ºè·¯ç”±å™¨
router = Router()

@group("/api/v1")
class HelloController:
    @router.get("/hello")
    async def hello_world(self) -> APIResponse[str]:
        return APIResponse.success("Hello, FastAPI Keystone!")

    @router.get("/hello/{name}")
    async def hello_name(self, name: str) -> APIResponse[str]:
        return APIResponse.success(f"Hello, {name}!")

def main():
    # åˆ›å»ºåº”ç”¨ç®¡ç†å™¨å¹¶è®¾ç½®æœåŠ¡å™¨
    manager = AppManager("config.json", modules=[])
    server = manager.setup_server([HelloController])
    
    # å¯åŠ¨æœåŠ¡å™¨
    uvicorn.run(server.get_app(), host="0.0.0.0", port=8000)

if __name__ == "__main__":
    main()
```

### 2. é…ç½®æ–‡ä»¶ç¤ºä¾‹

åˆ›å»º `config.json`ï¼š

```json
{
  "server": {
    "title": "My FastAPI App",
    "description": "åŸºäº FastAPI Keystone çš„åº”ç”¨",
    "version": "1.0.0",
    "host": "0.0.0.0",
    "port": 8000
  },
  "logger": {
    "level": "INFO",
    "format": "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  },
  "databases": {
    "default": {
      "host": "localhost",
      "port": 5432,
      "user": "postgres",
      "password": "password",
      "database": "myapp"
    }
  }
}
```

æˆ–ä½¿ç”¨ YAML æ ¼å¼ `config.yaml`ï¼š

```yaml
server:
  title: My FastAPI App
  description: åŸºäº FastAPI Keystone çš„åº”ç”¨
  version: 1.0.0
  host: 0.0.0.0
  port: 8000

logger:
  level: INFO
  format: '%(asctime)s - %(name)s - %(levelname)s - %(message)s'

databases:
  default:
    host: localhost
    port: 5432
    user: postgres
    password: password
    database: myapp
```

### 3. ä¾èµ–æ³¨å…¥

```python
from injector import Module, provider, singleton, inject
from fastapi_keystone.config import Config
from fastapi_keystone.core.app import AppManager

# å®šä¹‰æœåŠ¡
class UserService:
    def __init__(self, config: Config):
        self.config = config
    
    def get_user(self, user_id: int):
        return {"id": user_id, "name": f"User {user_id}"}

# ä¾èµ–æ³¨å…¥æ¨¡å—
class ServiceModule(Module):
    @provider
    @singleton
    def user_service(self, config: Config) -> UserService:
        return UserService(config)

@group("/api/v1/users")
class UserController:
    @inject
    def __init__(self, user_service: UserService):
        self.user_service = user_service
    
    @router.get("/{user_id}")
    async def get_user(self, user_id: int) -> APIResponse[dict]:
        user = self.user_service.get_user(user_id)
        return APIResponse.success(user)

def main():
    # åˆ›å»ºåº”ç”¨ç®¡ç†å™¨å¹¶æ³¨å†Œæ¨¡å—
    manager = AppManager("config.json", modules=[ServiceModule()])
    server = manager.setup_server([UserController])
    
    return server.get_app()
```

### 4. ä¸­é—´ä»¶é…ç½®

```python
from fastapi_keystone.core.server import Server

def main():
    manager = AppManager("config.json", modules=[])
    
    # è·å–æœåŠ¡å™¨å®ä¾‹å¹¶é…ç½®ä¸­é—´ä»¶
    server = manager.get_instance(Server)
    server.enable_cors(
        allow_origins=["*"],
        allow_methods=["*"],
        allow_headers=["*"]
    )
    server.enable_simple_trace()
    # Gzip é»˜è®¤å¯ç”¨ï¼Œå¦‚éœ€ç¦ç”¨å¯è°ƒç”¨ server.disable_gzip()
    
    # è®¾ç½® API
    app = server.setup_api([HelloController])
    return app
```

### 5. å¼‚å¸¸å¤„ç†

```python
from fastapi_keystone.core.exceptions import APIException

@group("/api/v1/users")
class UserController:
    @router.get("/{user_id}")
    async def get_user(self, user_id: int) -> APIResponse[dict]:
        if user_id <= 0:
            raise APIException("Invalid user ID", code=400)
        
        if user_id > 1000:
            raise APIException("User not found", code=404)
        
        return APIResponse.success({"id": user_id, "name": f"User {user_id}"})
```

## API å“åº”æ ¼å¼

æ‰€æœ‰ API å“åº”éƒ½éµå¾ªç»Ÿä¸€æ ¼å¼ï¼š

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "name": "User 1"
  }
}
```

é”™è¯¯å“åº”ï¼š

```json
{
  "code": 404,
  "message": "User not found",
  "data": null
}
```

åˆ†é¡µå“åº”ï¼š

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {"id": 1, "name": "User 1"},
    {"id": 2, "name": "User 2"}
  ],
  "total": 100,
  "page": 1,
  "size": 10
}
```

## é¡¹ç›®ç»“æ„å»ºè®®

```
my-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.json          # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ controllers/         # æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ user_controller.py
â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ user_service.py
â”‚   â””â”€â”€ models/             # æ•°æ®æ¨¡å‹
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ user.py
â”œâ”€â”€ tests/                  # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

## é…ç½®æ‰©å±•

æ¡†æ¶æ”¯æŒè‡ªå®šä¹‰é…ç½®æ®µï¼š

```python
from pydantic import BaseModel, Field
from typing import Optional

class RedisConfig(BaseModel):
    host: str = Field(default="127.0.0.1")
    port: int = Field(default=6379)
    password: Optional[str] = None
    database: int = Field(default=0)

# åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ 
{
  "redis": {
    "host": "redis.example.com",
    "port": 6380,
    "password": "secret",
    "database": 1
  }
}

# åœ¨ä»£ç ä¸­ä½¿ç”¨
config = load_config("config.json")
redis_config = config.get_section("redis", RedisConfig)
```

## æµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•
pytest

# è¿è¡Œæµ‹è¯•å¹¶æŸ¥çœ‹è¦†ç›–ç‡
pytest --cov=src --cov-report=html

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_routing.py
```

## å¼€å‘

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/alphaqiu/fastapi-keystone.git
cd fastapi-keystone

# å®‰è£…å¼€å‘ä¾èµ–
uv sync

# è¿è¡Œæµ‹è¯•
uv run pytest

# ä»£ç æ ¼å¼åŒ–
uv run black .
uv run isort .

# ä»£ç æ£€æŸ¥
uv run ruff check .
```

## æ³¨æ„äº‹é¡¹

1. **ç‰ˆæœ¬å…¼å®¹æ€§**ï¼šæœ¬é¡¹ç›®ä»åœ¨å¼€å‘ä¸­ï¼ŒAPI å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–
2. **ç”Ÿäº§ä½¿ç”¨**ï¼šå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰è¿›è¡Œå……åˆ†æµ‹è¯•
3. **ä¾èµ–ç®¡ç†**ï¼šç¡®ä¿ FastAPI å’Œç›¸å…³ä¾èµ–ç‰ˆæœ¬å…¼å®¹
4. **é…ç½®å®‰å…¨**ï¼šç”Ÿäº§ç¯å¢ƒä¸­æ³¨æ„ä¿æŠ¤æ•æ„Ÿé…ç½®ä¿¡æ¯

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) è®¸å¯è¯ã€‚

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestã€‚åœ¨æäº¤ä»£ç å‰ï¼Œè¯·ç¡®ä¿ï¼š

- ä»£ç é€šè¿‡æ‰€æœ‰æµ‹è¯•
- éµå¾ªé¡¹ç›®çš„ä»£ç é£æ ¼
- æ·»åŠ å¿…è¦çš„æµ‹è¯•ç”¨ä¾‹
- æ›´æ–°ç›¸å…³æ–‡æ¡£

## é“¾æ¥

- **GitHub**: https://github.com/alphaqiu/fastapi-keystone
- **PyPI**: https://pypi.org/project/fastapi-keystone/
- **æ–‡æ¡£**: https://github.com/alphaqiu/fastapi-keystone#readme
- **é—®é¢˜åé¦ˆ**: https://github.com/alphaqiu/fastapi-keystone/issues
