"use strict";(self.webpackChunkjupyterlab_urdf=self.webpackChunkjupyterlab_urdf||[]).push([[177],{177:(t,e,r)=>{function n(t){const e=t.split(/[\\/]/g);return e.pop(),0===e.length?"./":e.join("/")+"/"}function s(t,e,r=[]){t.tagName===e&&r.push(t);for(let n=0,i=t.children.length;n<i;n++)s(t.children[n],e,r);return r}function i(t,e){const r=t.cloneNode(),n=t.childNodes;for(let t=0,s=n.length;t<s;t++){const s=n[t],o=s.tagName;(!e||"xacro:property"!==o&&"xacro:macro"!==o)&&r.appendChild(i(s,e))}return r}function o(t){for(;t.length>0;){const e=t[t.length-1];if(e.nodeType===e.ELEMENT_NODE)break;t.pop()}}function a(t){return/^(('[^']*?')|("[^"]*?")|(`[^`]*?`))$/.test(t)}function p(t){return!isNaN(Number(t))&&!isNaN(parseFloat(t))}r.r(e),r.d(e,{XacroLoader:()=>ee,XacroParser:()=>te});const u=Symbol("parent");function h(...t){const e={};for(let r=0,n=t.length;r<n;r++){const n=t[r];for(const t in n)e[t]=n[t];u in n&&(e[u]=n[u])}return e}var c="INUMBER",l="IOP1",f="IOP2",v="IOP3",y="IVAR",d="IVARNAME",g="IFUNCALL",x="IFUNDEF",w="IEXPR",m="IEXPREVAL",b="IMEMBER",E="IENDSTATEMENT",M="IARRAY";function A(t,e){this.type=t,this.value=null!=e?e:0}function k(t){return new A(l,t)}function O(t){return new A(f,t)}function T(t){return new A(v,t)}function N(t,e,r,n,s){for(var i,o,a,p,u=[],h=[],g=0;g<t.length;g++){var x=t[g],m=x.type;if(m===c||m===d)Array.isArray(x.value)?u.push.apply(u,N(x.value.map((function(t){return new A(c,t)})).concat(new A(M,x.value.length)),e,r,n,s)):u.push(x);else if(m===y&&s.hasOwnProperty(x.value))x=new A(c,s[x.value]),u.push(x);else if(m===f&&u.length>1)o=u.pop(),i=u.pop(),p=r[x.value],x=new A(c,p(i.value,o.value)),u.push(x);else if(m===v&&u.length>2)a=u.pop(),o=u.pop(),i=u.pop(),"?"===x.value?u.push(i.value?o.value:a.value):(p=n[x.value],x=new A(c,p(i.value,o.value,a.value)),u.push(x));else if(m===l&&u.length>0)i=u.pop(),p=e[x.value],x=new A(c,p(i.value)),u.push(x);else if(m===w){for(;u.length>0;)h.push(u.shift());h.push(new A(w,N(x.value,e,r,n,s)))}else if(m===b&&u.length>0)i=u.pop(),u.push(new A(c,i.value[x.value]));else{for(;u.length>0;)h.push(u.shift());h.push(x)}}for(;u.length>0;)h.push(u.shift());return h}function C(t,e,r){for(var n=[],s=0;s<t.length;s++){var i=t[s],o=i.type;if(o===y&&i.value===e)for(var a=0;a<r.tokens.length;a++){var p,u=r.tokens[a];p=u.type===l?k(u.value):u.type===f?O(u.value):u.type===v?T(u.value):new A(u.type,u.value),n.push(p)}else o===w?n.push(new A(w,C(i.value,e,r))):n.push(i)}return n}function P(t,e,r){var n,s,i,o,a,p,u=[];if(I(t))return F(t,r);for(var h=t.length,A=0;A<h;A++){var k=t[A],O=k.type;if(O===c||O===d)u.push(k.value);else if(O===f)s=u.pop(),n=u.pop(),"and"===k.value?u.push(!!n&&!!P(s,e,r)):"or"===k.value?u.push(!!n||!!P(s,e,r)):"="===k.value?(o=e.binaryOps[k.value],u.push(o(n,P(s,e,r),r))):(o=e.binaryOps[k.value],u.push(o(F(n,r),F(s,r))));else if(O===v)i=u.pop(),s=u.pop(),n=u.pop(),"?"===k.value?u.push(P(n?s:i,e,r)):(o=e.ternaryOps[k.value],u.push(o(F(n,r),F(s,r),F(i,r))));else if(O===y)if(k.value in e.functions)u.push(e.functions[k.value]);else if(k.value in e.unaryOps&&e.parser.isOperatorEnabled(k.value))u.push(e.unaryOps[k.value]);else{var T=r[k.value];if(void 0===T)throw new Error("undefined variable: "+k.value);u.push(T)}else if(O===l)n=u.pop(),o=e.unaryOps[k.value],u.push(o(F(n,r)));else if(O===g){for(p=k.value,a=[];p-- >0;)a.unshift(F(u.pop(),r));if(!(o=u.pop()).apply||!o.call)throw new Error(o+" is not a function");u.push(o.apply(void 0,a))}else if(O===x)u.push(function(){for(var t=u.pop(),n=[],s=k.value;s-- >0;)n.unshift(u.pop());var i=u.pop(),o=function(){for(var s=Object.assign({},r),i=0,o=n.length;i<o;i++)s[n[i]]=arguments[i];return P(t,e,s)};return Object.defineProperty(o,"name",{value:i,writable:!1}),r[i]=o,o}());else if(O===w)u.push($(k,e));else if(O===m)u.push(k);else if(O===b)n=u.pop(),u.push(n[k.value]);else if(O===E)u.pop();else{if(O!==M)throw new Error("invalid Expression");for(p=k.value,a=[];p-- >0;)a.unshift(u.pop());u.push(a)}}if(u.length>1)throw new Error("invalid Expression (parity)");return 0===u[0]?0:F(u[0],r)}function $(t,e,r){return I(t)?t:{type:m,value:function(r){return P(t.value,e,r)}}}function I(t){return t&&t.type===m}function F(t,e){return I(t)?t.value(e):t}function S(t,e){for(var r,n,s,i,o,a,p=[],u=0;u<t.length;u++){var h=t[u],m=h.type;if(m===c)"number"==typeof h.value&&h.value<0?p.push("("+h.value+")"):Array.isArray(h.value)?p.push("["+h.value.map(L).join(", ")+"]"):p.push(L(h.value));else if(m===f)n=p.pop(),r=p.pop(),i=h.value,e?"^"===i?p.push("Math.pow("+r+", "+n+")"):"and"===i?p.push("(!!"+r+" && !!"+n+")"):"or"===i?p.push("(!!"+r+" || !!"+n+")"):"||"===i?p.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+r+"),("+n+")))"):"=="===i?p.push("("+r+" === "+n+")"):"!="===i?p.push("("+r+" !== "+n+")"):"["===i?p.push(r+"[("+n+") | 0]"):p.push("("+r+" "+i+" "+n+")"):"["===i?p.push(r+"["+n+"]"):p.push("("+r+" "+i+" "+n+")");else if(m===v){if(s=p.pop(),n=p.pop(),r=p.pop(),"?"!==(i=h.value))throw new Error("invalid Expression");p.push("("+r+" ? "+n+" : "+s+")")}else if(m===y||m===d)p.push(h.value);else if(m===l)r=p.pop(),"-"===(i=h.value)||"+"===i?p.push("("+i+r+")"):e?"not"===i?p.push("(!"+r+")"):"!"===i?p.push("fac("+r+")"):p.push(i+"("+r+")"):"!"===i?p.push("("+r+"!)"):p.push("("+i+" "+r+")");else if(m===g){for(a=h.value,o=[];a-- >0;)o.unshift(p.pop());i=p.pop(),p.push(i+"("+o.join(", ")+")")}else if(m===x){for(n=p.pop(),a=h.value,o=[];a-- >0;)o.unshift(p.pop());r=p.pop(),e?p.push("("+r+" = function("+o.join(", ")+") { return "+n+" })"):p.push("("+r+"("+o.join(", ")+") = "+n+")")}else if(m===b)r=p.pop(),p.push(r+"."+h.value);else if(m===M){for(a=h.value,o=[];a-- >0;)o.unshift(p.pop());p.push("["+o.join(", ")+"]")}else if(m===w)p.push("("+S(h.value,e)+")");else if(m!==E)throw new Error("invalid Expression")}return p.length>1&&(p=e?[p.join(",")]:[p.join(";")]),String(p[0])}function L(t){return"string"==typeof t?JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):t}function _(t,e){for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1}function j(t,e,r){for(var n=!!(r=r||{}).withMembers,s=null,i=0;i<t.length;i++){var o=t[i];o.type===y||o.type===d?n||_(e,o.value)?null!==s?(_(e,s)||e.push(s),s=o.value):s=o.value:e.push(o.value):o.type===b&&n&&null!==s?s+="."+o.value:o.type===w?j(o.value,e,r):null!==s&&(_(e,s)||e.push(s),s=null)}null===s||_(e,s)||e.push(s)}function X(t,e){this.tokens=t,this.parser=e,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.functions=e.functions}A.prototype.toString=function(){switch(this.type){case c:case l:case f:case v:case y:case d:case E:return this.value;case g:return"CALL "+this.value;case x:return"DEF "+this.value;case M:return"ARRAY "+this.value;case b:return"."+this.value;default:return"Invalid Instruction"}},X.prototype.simplify=function(t){return t=t||{},new X(N(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,t),this.parser)},X.prototype.substitute=function(t,e){return e instanceof X||(e=this.parser.parse(String(e))),new X(C(this.tokens,t,e),this.parser)},X.prototype.evaluate=function(t){return t=t||{},P(this.tokens,this,t)},X.prototype.toString=function(){return S(this.tokens,!1)},X.prototype.symbols=function(t){t=t||{};var e=[];return j(this.tokens,e,t),e},X.prototype.variables=function(t){t=t||{};var e=[];j(this.tokens,e,t);var r=this.functions;return e.filter((function(t){return!(t in r)}))},X.prototype.toJSFunction=function(t,e){var r=this,n=new Function(t,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+S(this.simplify(e).tokens,!0)+"; }");return function(){return n.apply(r,arguments)}};var R="TEOF",U="TOP",B="TNUMBER",q="TSTRING",D="TPAREN",V="TBRACKET",K="TCOMMA",W="TNAME",J="TSEMICOLON";function z(t,e,r){this.type=t,this.value=e,this.index=r}function G(t,e){this.pos=0,this.current=null,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.consts=t.consts,this.expression=e,this.savedPosition=0,this.savedCurrent=null,this.options=t.options,this.parser=t}z.prototype.toString=function(){return this.type+": "+this.value},G.prototype.newToken=function(t,e,r){return new z(t,e,null!=r?r:this.pos)},G.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},G.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},G.prototype.next=function(){return this.pos>=this.expression.length?this.newToken(R,"EOF"):this.isWhitespace()||this.isComment()?this.next():this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},G.prototype.isString=function(){var t=!1,e=this.pos,r=this.expression.charAt(e);if("'"===r||'"'===r)for(var n=this.expression.indexOf(r,e+1);n>=0&&this.pos<this.expression.length;){if(this.pos=n+1,"\\"!==this.expression.charAt(n-1)){var s=this.expression.substring(e+1,n);this.current=this.newToken(q,this.unescape(s),e),t=!0;break}n=this.expression.indexOf(r,n+1)}return t},G.prototype.isParen=function(){var t=this.expression.charAt(this.pos);return("("===t||")"===t)&&(this.current=this.newToken(D,t),this.pos++,!0)},G.prototype.isBracket=function(){var t=this.expression.charAt(this.pos);return!("["!==t&&"]"!==t||!this.isOperatorEnabled("[")||(this.current=this.newToken(V,t),this.pos++,0))},G.prototype.isComma=function(){return","===this.expression.charAt(this.pos)&&(this.current=this.newToken(K,","),this.pos++,!0)},G.prototype.isSemicolon=function(){return";"===this.expression.charAt(this.pos)&&(this.current=this.newToken(J,";"),this.pos++,!0)},G.prototype.isConst=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||"_"!==r&&"."!==r&&(r<"0"||r>"9")))break}if(e>t){var n=this.expression.substring(t,e);if(n in this.consts)return this.current=this.newToken(B,this.consts[n]),this.pos+=n.length,!0}return!1},G.prototype.isNamedOp=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||"_"!==r&&(r<"0"||r>"9")))break}if(e>t){var n=this.expression.substring(t,e);if(this.isOperatorEnabled(n)&&(n in this.binaryOps||n in this.unaryOps||n in this.ternaryOps))return this.current=this.newToken(U,n),this.pos+=n.length,!0}return!1},G.prototype.isName=function(){for(var t=this.pos,e=t,r=!1;e<this.expression.length;e++){var n=this.expression.charAt(e);if(n.toUpperCase()===n.toLowerCase()){if(e===this.pos&&("$"===n||"_"===n)){"_"===n&&(r=!0);continue}if(e===this.pos||!r||"_"!==n&&(n<"0"||n>"9"))break}else r=!0}if(r){var s=this.expression.substring(t,e);return this.current=this.newToken(W,s),this.pos+=s.length,!0}return!1},G.prototype.isWhitespace=function(){for(var t=!1,e=this.expression.charAt(this.pos);!(" "!==e&&"\t"!==e&&"\n"!==e&&"\r"!==e||(t=!0,this.pos++,this.pos>=this.expression.length));)e=this.expression.charAt(this.pos);return t};var Y=/^[0-9a-f]{4}$/i;function Z(t,e,r){this.parser=t,this.tokens=e,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=!1!==r.allowMemberAccess}G.prototype.unescape=function(t){var e=t.indexOf("\\");if(e<0)return t;for(var r=t.substring(0,e);e>=0;){var n=t.charAt(++e);switch(n){case"'":r+="'";break;case'"':r+='"';break;case"\\":r+="\\";break;case"/":r+="/";break;case"b":r+="\b";break;case"f":r+="\f";break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"u":var s=t.substring(e+1,e+5);Y.test(s)||this.parseError("Illegal escape sequence: \\u"+s),r+=String.fromCharCode(parseInt(s,16)),e+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+n+'"')}++e;var i=t.indexOf("\\",e);r+=t.substring(e,i<0?t.length:i),e=i}return r},G.prototype.isComment=function(){return"/"===this.expression.charAt(this.pos)&&"*"===this.expression.charAt(this.pos+1)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)},G.prototype.isRadixInteger=function(){var t,e,r=this.pos;if(r>=this.expression.length-2||"0"!==this.expression.charAt(r))return!1;if(++r,"x"===this.expression.charAt(r))t=16,e=/^[0-9a-f]$/i,++r;else{if("b"!==this.expression.charAt(r))return!1;t=2,e=/^[01]$/i,++r}for(var n=!1,s=r;r<this.expression.length;){var i=this.expression.charAt(r);if(!e.test(i))break;r++,n=!0}return n&&(this.current=this.newToken(B,parseInt(this.expression.substring(s,r),t)),this.pos=r),n},G.prototype.isNumber=function(){for(var t,e=!1,r=this.pos,n=r,s=r,i=!1,o=!1;r<this.expression.length&&((t=this.expression.charAt(r))>="0"&&t<="9"||!i&&"."===t);)"."===t?i=!0:o=!0,r++,e=o;if(e&&(s=r),"e"===t||"E"===t){r++;for(var a=!0,p=!1;r<this.expression.length;){if(t=this.expression.charAt(r),!a||"+"!==t&&"-"!==t){if(!(t>="0"&&t<="9"))break;p=!0,a=!1}else a=!1;r++}p||(r=s)}return e?(this.current=this.newToken(B,parseFloat(this.expression.substring(n,r))),this.pos=r):this.pos=s,e},G.prototype.isOperator=function(){var t=this.pos,e=this.expression.charAt(this.pos);if("+"===e||"-"===e||"*"===e||"/"===e||"%"===e||"^"===e||"?"===e||":"===e||"."===e)this.current=this.newToken(U,e);else if("∙"===e||"•"===e)this.current=this.newToken(U,"*");else if(">"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(U,">="),this.pos++):this.current=this.newToken(U,">");else if("<"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(U,"<="),this.pos++):this.current=this.newToken(U,"<");else if("|"===e){if("|"!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(U,"||"),this.pos++}else if("="===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(U,"=="),this.pos++):this.current=this.newToken(U,e);else{if("!"!==e)return!1;"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(U,"!="),this.pos++):this.current=this.newToken(U,e)}return this.pos++,!!this.isOperatorEnabled(this.current.value)||(this.pos=t,!1)},G.prototype.isOperatorEnabled=function(t){return this.parser.isOperatorEnabled(t)},G.prototype.getCoordinates=function(){var t,e=0,r=-1;do{e++,t=this.pos-r,r=this.expression.indexOf("\n",r+1)}while(r>=0&&r<this.pos);return{line:e,column:t}},G.prototype.parseError=function(t){var e=this.getCoordinates();throw new Error("parse error ["+e.line+":"+e.column+"]: "+t)},Z.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},Z.prototype.tokenMatches=function(t,e){return void 0===e||(Array.isArray(e)?_(e,t.value):"function"==typeof e?e(t):t.value===e)},Z.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},Z.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},Z.prototype.accept=function(t,e){return!(this.nextToken.type!==t||!this.tokenMatches(this.nextToken,e)||(this.next(),0))},Z.prototype.expect=function(t,e){if(!this.accept(t,e)){var r=this.tokens.getCoordinates();throw new Error("parse error ["+r.line+":"+r.column+"]: Expected "+(e||t))}},Z.prototype.parseAtom=function(t){var e=this.tokens.unaryOps;if(this.accept(W)||this.accept(U,(function(t){return t.value in e})))t.push(new A(y,this.current.value));else if(this.accept(B))t.push(new A(c,this.current.value));else if(this.accept(q))t.push(new A(c,this.current.value));else if(this.accept(D,"("))this.parseExpression(t),this.expect(D,")");else{if(!this.accept(V,"["))throw new Error("unexpected "+this.nextToken);if(this.accept(V,"]"))t.push(new A(M,0));else{var r=this.parseArrayList(t);t.push(new A(M,r))}}},Z.prototype.parseExpression=function(t){var e=[];this.parseUntilEndStatement(t,e)||(this.parseVariableAssignmentExpression(e),this.parseUntilEndStatement(t,e)||this.pushExpression(t,e))},Z.prototype.pushExpression=function(t,e){for(var r=0,n=e.length;r<n;r++)t.push(e[r])},Z.prototype.parseUntilEndStatement=function(t,e){return!!this.accept(J)&&(!this.nextToken||this.nextToken.type===R||this.nextToken.type===D&&")"===this.nextToken.value||e.push(new A(E)),this.nextToken.type!==R&&this.parseExpression(e),t.push(new A(w,e)),!0)},Z.prototype.parseArrayList=function(t){for(var e=0;!this.accept(V,"]");)for(this.parseExpression(t),++e;this.accept(K);)this.parseExpression(t),++e;return e},Z.prototype.parseVariableAssignmentExpression=function(t){for(this.parseConditionalExpression(t);this.accept(U,"=");){var e=t.pop(),r=[],n=t.length-1;if(e.type!==g){if(e.type!==y&&e.type!==b)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(r),t.push(new A(d,e.value)),t.push(new A(w,r)),t.push(O("="))}else{if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var s=0,i=e.value+1;s<i;s++){var o=n-s;t[o].type===y&&(t[o]=new A(d,t[o].value))}this.parseVariableAssignmentExpression(r),t.push(new A(w,r)),t.push(new A(x,e.value))}}},Z.prototype.parseConditionalExpression=function(t){for(this.parseOrExpression(t);this.accept(U,"?");){var e=[],r=[];this.parseConditionalExpression(e),this.expect(U,":"),this.parseConditionalExpression(r),t.push(new A(w,e)),t.push(new A(w,r)),t.push(T("?"))}},Z.prototype.parseOrExpression=function(t){for(this.parseAndExpression(t);this.accept(U,"or");){var e=[];this.parseAndExpression(e),t.push(new A(w,e)),t.push(O("or"))}},Z.prototype.parseAndExpression=function(t){for(this.parseComparison(t);this.accept(U,"and");){var e=[];this.parseComparison(e),t.push(new A(w,e)),t.push(O("and"))}};var H=["==","!=","<","<=",">=",">","in"];Z.prototype.parseComparison=function(t){for(this.parseAddSub(t);this.accept(U,H);){var e=this.current;this.parseAddSub(t),t.push(O(e.value))}};var Q=["+","-","||"];Z.prototype.parseAddSub=function(t){for(this.parseTerm(t);this.accept(U,Q);){var e=this.current;this.parseTerm(t),t.push(O(e.value))}};var tt=["*","/","%"];function et(t,e){return Number(t)+Number(e)}function rt(t,e){return t-e}function nt(t,e){return t*e}function st(t,e){return t/e}function it(t,e){return t%e}function ot(t,e){return Array.isArray(t)&&Array.isArray(e)?t.concat(e):""+t+e}function at(t,e){return t===e}function pt(t,e){return t!==e}function ut(t,e){return t>e}function ht(t,e){return t<e}function ct(t,e){return t>=e}function lt(t,e){return t<=e}function ft(t,e){return Boolean(t&&e)}function vt(t,e){return Boolean(t||e)}function yt(t,e){return _(e,t)}function dt(t){return(Math.exp(t)-Math.exp(-t))/2}function gt(t){return(Math.exp(t)+Math.exp(-t))/2}function xt(t){return t===1/0?1:t===-1/0?-1:(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function wt(t){return t===-1/0?t:Math.log(t+Math.sqrt(t*t+1))}function mt(t){return Math.log(t+Math.sqrt(t*t-1))}function bt(t){return Math.log((1+t)/(1-t))/2}function Et(t){return Math.log(t)*Math.LOG10E}function Mt(t){return-t}function At(t){return!t}function kt(t){return t<0?Math.ceil(t):Math.floor(t)}function Ot(t){return Math.random()*(t||1)}function Tt(t){return Pt(t+1)}Z.prototype.parseTerm=function(t){for(this.parseFactor(t);this.accept(U,tt);){var e=this.current;this.parseFactor(t),t.push(O(e.value))}},Z.prototype.parseFactor=function(t){var e=this.tokens.unaryOps;if(this.save(),this.accept(U,(function(t){return t.value in e}))){if("-"!==this.current.value&&"+"!==this.current.value){if(this.nextToken.type===D&&"("===this.nextToken.value)return this.restore(),void this.parseExponential(t);if(this.nextToken.type===J||this.nextToken.type===K||this.nextToken.type===R||this.nextToken.type===D&&")"===this.nextToken.value)return this.restore(),void this.parseAtom(t)}var r=this.current;this.parseFactor(t),t.push(k(r.value))}else this.parseExponential(t)},Z.prototype.parseExponential=function(t){for(this.parsePostfixExpression(t);this.accept(U,"^");)this.parseFactor(t),t.push(O("^"))},Z.prototype.parsePostfixExpression=function(t){for(this.parseFunctionCall(t);this.accept(U,"!");)t.push(k("!"))},Z.prototype.parseFunctionCall=function(t){var e=this.tokens.unaryOps;if(this.accept(U,(function(t){return t.value in e}))){var r=this.current;this.parseAtom(t),t.push(k(r.value))}else for(this.parseMemberExpression(t);this.accept(D,"(");)if(this.accept(D,")"))t.push(new A(g,0));else{var n=this.parseArgumentList(t);t.push(new A(g,n))}},Z.prototype.parseArgumentList=function(t){for(var e=0;!this.accept(D,")");)for(this.parseExpression(t),++e;this.accept(K);)this.parseExpression(t),++e;return e},Z.prototype.parseMemberExpression=function(t){for(this.parseAtom(t);this.accept(U,".")||this.accept(V,"[");){var e=this.current;if("."===e.value){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(W),t.push(new A(b,this.current.value))}else{if("["!==e.value)throw new Error("unexpected symbol: "+e.value);if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(t),this.expect(V,"]"),t.push(O("["))}}};var Nt=4.7421875,Ct=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function Pt(t){var e,r;if(function(t){return isFinite(t)&&t===Math.round(t)}(t)){if(t<=0)return isFinite(t)?1/0:NaN;if(t>171)return 1/0;for(var n=t-2,s=t-1;n>1;)s*=n,n--;return 0===s&&(s=1),s}if(t<.5)return Math.PI/(Math.sin(Math.PI*t)*Pt(1-t));if(t>=171.35)return 1/0;if(t>85){var i=t*t,o=i*t,a=o*t,p=a*t;return Math.sqrt(2*Math.PI/t)*Math.pow(t/Math.E,t)*(1+1/(12*t)+1/(288*i)-139/(51840*o)-571/(2488320*a)+163879/(209018880*p)+5246819/(75246796800*p*t))}--t,r=Ct[0];for(var u=1;u<Ct.length;++u)r+=Ct[u]/(t+u);return e=t+Nt+.5,Math.sqrt(2*Math.PI)*Math.pow(e,t+.5)*Math.exp(-e)*r}function $t(t){return Array.isArray(t)?t.length:String(t).length}function It(){for(var t=0,e=0,r=0;r<arguments.length;r++){var n,s=Math.abs(arguments[r]);e<s?(t=t*(n=e/s)*n+1,e=s):t+=s>0?(n=s/e)*n:s}return e===1/0?1/0:e*Math.sqrt(t)}function Ft(t,e,r){return t?e:r}function St(t,e){return void 0===e||0==+e?Math.round(t):(t=+t,e=-+e,isNaN(t)||"number"!=typeof e||e%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math.round(+(t[0]+"e"+(t[1]?+t[1]-e:-e)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+e:e))))}function Lt(t,e,r){return r&&(r[t]=e),e}function _t(t,e){return t[0|e]}function jt(t){return 1===arguments.length&&Array.isArray(t)?Math.max.apply(Math,t):Math.max.apply(Math,arguments)}function Xt(t){return 1===arguments.length&&Array.isArray(t)?Math.min.apply(Math,t):Math.min.apply(Math,arguments)}function Rt(t,e){if("function"!=typeof t)throw new Error("First argument to map is not a function");if(!Array.isArray(e))throw new Error("Second argument to map is not an array");return e.map((function(e,r){return t(e,r)}))}function Ut(t,e,r){if("function"!=typeof t)throw new Error("First argument to fold is not a function");if(!Array.isArray(r))throw new Error("Second argument to fold is not an array");return r.reduce((function(e,r,n){return t(e,r,n)}),e)}function Bt(t,e){if("function"!=typeof t)throw new Error("First argument to filter is not a function");if(!Array.isArray(e))throw new Error("Second argument to filter is not an array");return e.filter((function(e,r){return t(e,r)}))}function qt(t,e){if(!Array.isArray(e)&&"string"!=typeof e)throw new Error("Second argument to indexOf is not a string or array");return e.indexOf(t)}function Dt(t,e){if(!Array.isArray(e))throw new Error("Second argument to join is not an array");return e.join(t)}function Vt(t){return(t>0)-(t<0)||+t}var Kt=1/3;function Wt(t){return t<0?-Math.pow(-t,Kt):Math.pow(t,Kt)}function Jt(t){return Math.exp(t)-1}function zt(t){return Math.log(1+t)}function Gt(t){return Math.log(t)/Math.LN2}function Yt(t){this.options=t||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||dt,cosh:Math.cosh||gt,tanh:Math.tanh||xt,asinh:Math.asinh||wt,acosh:Math.acosh||mt,atanh:Math.atanh||bt,sqrt:Math.sqrt,cbrt:Math.cbrt||Wt,log:Math.log,log2:Math.log2||Gt,ln:Math.log,lg:Math.log10||Et,log10:Math.log10||Et,expm1:Math.expm1||Jt,log1p:Math.log1p||zt,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||kt,"-":Mt,"+":Number,exp:Math.exp,not:At,length:$t,"!":Tt,sign:Math.sign||Vt},this.binaryOps={"+":et,"-":rt,"*":nt,"/":st,"%":it,"^":Math.pow,"||":ot,"==":at,"!=":pt,">":ut,"<":ht,">=":ct,"<=":lt,and:ft,or:vt,in:yt,"=":Lt,"[":_t},this.ternaryOps={"?":Ft},this.functions={random:Ot,fac:Tt,min:Xt,max:jt,hypot:Math.hypot||It,pyt:Math.hypot||It,pow:Math.pow,atan2:Math.atan2,if:Ft,gamma:Pt,roundTo:St,map:Rt,fold:Ut,filter:Bt,indexOf:qt,join:Dt},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}Yt.prototype.parse=function(t){var e=[],r=new Z(this,new G(this,t),{allowMemberAccess:this.options.allowMemberAccess});return r.parseExpression(e),r.expect(R,"EOF"),new X(e,this)},Yt.prototype.evaluate=function(t,e){return this.parse(t).evaluate(e)};var Zt=new Yt;Yt.parse=function(t){return Zt.parse(t)},Yt.evaluate=function(t,e){return Zt.parse(t).evaluate(e)};var Ht={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};Yt.prototype.isOperatorEnabled=function(t){var e=function(t){return Ht.hasOwnProperty(t)?Ht[t]:t}(t),r=this.options.operators||{};return!(e in r)||!!r[e]};class Qt extends Yt{constructor(...t){super(...t);const e=this;e.unaryOps={"-":e.unaryOps["-"],"+":e.unaryOps["+"],"!":e.unaryOps.not,not:e.unaryOps.not},e.functions={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,log:Math.log,atan2:Math.atan2,pow:Math.pow,radians:t=>t*(Math.PI/180),degrees:t=>t*(180/Math.PI),__read_property__:(t,...e)=>{let r=t;for(let t=0,n=e.length;t<n;t++)r=r[e[t]];return r}},e.binaryOps={...e.binaryOps,"+":(t,e)=>(p(t)&&(t=Number(t)),p(e)&&(e=Number(e)),t+e),in:(t,e)=>Array.isArray(e)||"string"==typeof e?e.includes(t):t in e,"||":(t,e)=>Boolean(t||e)},e.consts={...e.consts,pi:Math.PI,e:Math.E}}}class te{constructor(){this.inOrder=!0,this.requirePrefix=!0,this.localProperties=!0,this.rospackCommands={},this.arguments={},this.expressionParser=new Qt,this.workingPath=""}async getFileContents(t){throw new Error("XacroParser: getFileContents() not implemented.")}async parse(t){function e(t,e,r=!1){const n=[],s=h(E,e);try{let e=function t(e,r){if("string"!=typeof e)return e;const s=e.split(/(\$?\$\([^)]+\))|(\$?\${[^}]+})/g).filter((t=>!!t)).map((e=>{if(!/^\$[{(].+/.test(e))return e;if(/^\$\$/.test(e))return e;const s=/^\$\(/.test(e);let i=e.substring(2,e.length-1);if(i=t(i,r),/\[.+\]$/.test(i)&&(i=i.replace(/([^[\s]+)(\[[^[]+\])+/g,((t,...e)=>{const r=t.split(/[[\]]+/g);return r.pop(),`__read_property__( ${r.join(",")} )`}))),!s){if(n.includes(i))throw new Error(`XacroParser: Cannot evaluate infinitely recursive expression: ${n.join(" > ")} > ${i}`);n.push(i);const e=/([()/*+!\-%|&=])+/g,s=function(t){return t.replace(/(('[^']*?')|("[^"]*?")|(`[^`]*?`)|([()/*+\-%|!&=]+?))/g,(t=>` ${t} `)).trim().split(/\s+/g)}(i).map((n=>{if(e.lastIndex=0,function(t){return/^[()/*+\-%|&=[\]]+$/.test(t)}(n))return n;if(p(n))return n;if(a(n))return n;if(n in r){const e=t(r[n],r);return p(e)||"object"==typeof e?e:`"${e.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}return n})).map((t=>(e.lastIndex=0,/^[^0-9.]/.test(t)&&!e.test(t)?` ${t} `:t))).join("");if(n.pop(),a(s))return s.substring(1,s.length-1);if(p(s))return s;{const t=function(t){return t.replace(/[-+]{2,}/,(t=>{let e=!0;for(let r=0,n=t.length;r<n;r++)"-"===t[r]&&(e=!e);return e?"+":"-"}))}(s);return A.evaluate(t,r)}}{const e=t(i,r).split(/\s+/g),n=e.shift();try{return M(n,...e)}catch(t){throw new Error(`XacroParser: Cannot run rospack command "${i}".\n`+t.message)}}})),i=s.filter((t=>("string"==typeof t&&(t=t.trim()),""!==t&&null!=t)));return 1===i.length?i[0]:s.join("")}(t,s);return r&&"string"==typeof e&&(e=e.replace(/\${2}([({])/g,((t,e)=>`$${e}`))),e}catch(e){throw new Error(`XacroParser: Failed to process expression "${t}". \n`+e.message)}}async function r(t,s,a,p=[]){if(t.nodeType===t.TEXT_NODE){const r=t.cloneNode();return r.textContent=e(r.textContent,s,!0),void p.push(r)}if(t.nodeType!==t.ELEMENT_NODE)return void p.push(t.cloneNode());let c=t.tagName.toLowerCase();if(!g)switch(c){case"arg":case"property":case"macro":case"insert_block":case"if":case"unless":case"include":case"element":case"attribute":c=`xacro:${c}`;break;default:c in a&&(c=`xacro:${c}`)}switch(c){case"xacro:property":{o(p);const r=t.getAttribute("name");let n;if(t.hasAttribute("value"))n=t.getAttribute("value");else if(t.hasAttribute("default"))n=t.getAttribute("default");else{const e=[...t.childNodes];n=[];for(const t of e)n.push(i(t,!1))}let a="global";k&&(a=t.getAttribute("scope")||"local"),"local"!==a&&(n=e(n,s)),"global"===a?E[r]=n:"parent"===a?s[u][r]=n:s[r]=n;break}case"xacro:macro":{o(p);const e=function(t){const e=t.getAttribute("name").replace(/^xacro:/,""),r=t.getAttribute("params"),n={};if(r){const t=r.trim().match(/[^\s']+('[^']*')?/g).map((t=>function(t){const e={};if(/^\*\*/.test(t)?e.type="MULTI_BLOCK":/^\*/.test(t)?e.type="BLOCK":e.type="PARAM",t=t.replace(/^\*{1,2}/g,""),/:?=/.test(t)){const[r,n]=t.split(/:?=/);if(/^\^/.test(n)||/\|/.test(n))throw new Error(`XacroParser: ROS Jade pass-through notation not supported in macro defaults: ${n}`);e.name=r,n.startsWith("'")&&n.endsWith("'")?e.def=n.substring(1,n.length-1):e.def=n}else e.name=t,e.def=null;return e}(t)));t.forEach((t=>{n[t.name]=t}))}return{name:e,node:i(t,!1),params:n}}(t);a[e.name]=e;break}case"xacro:insert_block":{o(p);const e=s[t.getAttribute("name")];for(const t of e)await r(t,s,a,p);return}case"xacro:if":case"xacro:unless":{o(p);const n=e(t.getAttribute("value"),s,!0);let i=null;if(i=isNaN(parseFloat(n))?"true"===n||"false"===n?"true"===n:n:!!parseFloat(n),"xacro:unless"===c&&(i=!i),i){const e=[...t.childNodes];for(const t of e)await r(t,s,a,p)}return}case"xacro:include":{if(o(p),t.hasAttribute("ns"))throw new Error("XacroParser: xacro:include name spaces not supported.");const i=e(t.getAttribute("filename"),s,!0),u=/^[/\\]/.test(i)||/^[a-zA-Z]+:[/\\]/.test(i)?i:O+i,h=O;O=n(u);const c=[...(await l(u)).children[0].childNodes];for(const t of c)await r(t,s,a,p);return void(O=h)}case"xacro:arg":{const r=t.getAttribute("name");return void(b[r]=e(t.getAttribute("default"),s,!0))}case"xacro:attribute":case"xacro:element":throw new Error(`XacroParser: ${c} tags not supported.`);default:if(/^xacro:/.test(c)||c in a)return o(p),async function(t,n,s,i){const o=t.tagName.replace(/^xacro:/,""),a=s[o];if(!a)throw new Error(`XacroParser: Cannot find macro "${o}"`);const p=n,c=s;n=function(t){const e=h(t);return e[u]=t,e}(n),s=h(s);let l=[];for(const e of t.children)await r(e,p,c,l);l=l.filter((t=>t.nodeType===t.ELEMENT_NODE));let f=0;for(const r in a.params){const s=a.params[r];t.hasAttribute(r)?n[r]=e(t.getAttribute(r),p):"BLOCK"===s.type?(n[r]=[l[f]],f++):"MULTI_BLOCK"===s.type?n[r]=[...l.filter((t=>t.tagName===r))[0].childNodes]:n[r]=e(a.params[r].def,p)}const v=[...a.node.childNodes];for(const t of v){const e=[];await r(t,n,s,e),i.push(...e)}}(t,s,a,p);{const n=t.cloneNode();for(let t=0,r=n.attributes.length;t<r;t++){const r=n.attributes[t],i=e(r.value,s,!0);n.setAttribute(r.name,i)}const i=[...t.childNodes],o=[];for(let t=0,e=i.length;t<e;t++)await r(i[t],s,a,o);o.forEach((t=>n.appendChild(t))),p.push(n)}}}async function c(t,e,n){const i=s(t,"xacro:property");g||i.push(...s(t,"property"));for(const t of i)await r(t,e,n);const o=s(t,"xacro:macro");g||o.push(...s(t,"macro"));for(const t of o)await r(t,e,n)}async function l(t){try{const e=await v.getFileContents(t);return(new DOMParser).parseFromString(e,"text/xml")}catch(e){throw new Error(`XacroParser: Could not load included file: ${t}`)}}async function f(t,e,r=[]){const i=s(t,"xacro:include");g||i.push(...s(t,"include"));const o=i.map((t=>{if(t.hasAttribute("ns"))throw new Error("XacroParser: xacro:include name spaces not supported.");const s=t.getAttribute("filename"),i=t.getAttribute("ns")||null,o=/^[/\\]/.test(s)||/^[a-zA-Z]+:[/\\]/.test(s)?s:e+s,a=l(o).then((t=>(r.push({filename:s,namespace:i,content:t}),f(t,n(o),r))));return a}));return await Promise.all(o),r}const v=this,y=this.inOrder,d=this.workingPath+(this.workingPath&&!/[\\/]$/.test(this.workingPath)?"/":""),g=this.requirePrefix,x=this.rospackCommands,w={},m={},b={},E={True:1,False:0};E[u]=E;const M=(t,...e)=>{let r;if(x instanceof Function&&(r=x(t,...e)),null==r&&null!=x&&"function"==typeof x[t]&&(r=x[t](...e)),null==r&&"arg"===t){const t=e[0];if(void 0===t)throw new Error("XacroParser: $(arg) must specify a variable name");if(r=this.arguments[t],null==r&&(r=b[t]),null==r)throw new Error(`XacroParser: Undefined substitution argument ${t}`)}return r},A=this.expressionParser;let k=this.localProperties,O=d,T=(new DOMParser).parseFromString(t,"text/xml");k&&!y&&(console.warn('XacroParser: Implicitly setting "localProperties" option to false because "inOrder" is false.'),k=!1);let N=null;return N=y?Promise.resolve():async function(){return await c(T,E,w),T=i(T,!0),f(T,d).then((t=>{t.forEach((t=>{c(t.content,E,w),t.content=i(t.content,!0),m[t.filename]=t.content}))}))}(),await N,async function(t,e,n){const s=t.cloneNode();for(let i=0,o=t.children.length;i<o;i++){const o=[];await r(t.children[i],e,n,o);const a=o[0];a.removeAttribute("xmlns:xacro"),s.appendChild(a)}return s}(T,E,w)}}class ee extends te{constructor(){super(),this.fetchOptions={}}load(t,e,r){const s=n(t);""===this.workingPath&&(this.workingPath=s),this.getFileContents(t).then((t=>{this.parse(t,e,r)})).catch((t=>{r&&r(t)}))}parse(t,e,r){super.parse(t).then(e).catch((t=>{r&&r(t)}))}getFileContents(t){return fetch(t,this.fetchOptions).then((e=>{if(e.ok)return e.text();throw new Error(`XacroLoader: Failed to load url '${t}' with error code ${e.status} : ${e.statusText}.`)}))}}}}]);