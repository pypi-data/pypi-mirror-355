#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∏ pytest-typed-schema-shot –ø–ª–∞–≥–∏–Ω–∞
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

set -e  # –ü—Ä–µ—Ä—ã–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

echo "üîÑ –ù–∞—á–∏–Ω–∞—é –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫—É pytest-typed-schema-shot –ø–ª–∞–≥–∏–Ω–∞..."

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo -e "${BLUE}üì¶ –£–¥–∞–ª—è—é —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é –ø–ª–∞–≥–∏–Ω–∞...${NC}"
pip uninstall pytest-typed-schema-shot -y 2>/dev/null || echo -e "${YELLOW}‚ö†Ô∏è  –ü–ª–∞–≥–∏–Ω –Ω–µ –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ä–∞–Ω–µ–µ${NC}"

echo -e "${BLUE}üßπ –û—á–∏—â–∞—é –∫—ç—à pip...${NC}"
pip cache purge

echo -e "${BLUE}üßπ –£–¥–∞–ª—è—é –∫—ç—à Python...${NC}"
find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
find . -name "*.pyc" -delete 2>/dev/null || true

echo -e "${BLUE}üî® –û—á–∏—â–∞—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é build...${NC}"
rm -rf build/ dist/ *.egg-info/ 2>/dev/null || true

echo -e "${BLUE}üî® –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞—é –ø–∞–∫–µ—Ç...${NC}"
python3 -m build

echo -e "${BLUE}üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –ø–ª–∞–≥–∏–Ω –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏...${NC}"
pip install -e .

echo -e "${BLUE}üîç –ü—Ä–æ–≤–µ—Ä—è—é —É—Å—Ç–∞–Ω–æ–≤–∫—É –ø–ª–∞–≥–∏–Ω–∞...${NC}"
if pip list | grep -q pytest-typed-schema-shot; then
    echo -e "${GREEN}‚úÖ –ü–ª–∞–≥–∏–Ω —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!${NC}"
    pip show pytest-typed-schema-shot
else
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: –ø–ª–∞–≥–∏–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏${NC}"
    exit 1
fi

echo -e "${BLUE}üß™ –ü—Ä–æ–≤–µ—Ä—è—é, —á—Ç–æ pytest –≤–∏–¥–∏—Ç –ø–ª–∞–≥–∏–Ω...${NC}"
if pytest --help | grep -q "schemashot"; then
    echo -e "${GREEN}‚úÖ Pytest —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏–ª –ø–ª–∞–≥–∏–Ω!${NC}"
else
    echo -e "${YELLOW}‚ö†Ô∏è  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: pytest –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–ª –æ–ø—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–∞${NC}"
fi

#echo -e "${BLUE}üèÉ –ó–∞–ø—É—Å–∫–∞—é –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã...${NC}"
#pytest tests/ -v

echo -e "${GREEN}üéâ –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!${NC}"
echo -e "${BLUE}üí° –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–ª–∞–≥–∏–Ω–∞${NC}"
