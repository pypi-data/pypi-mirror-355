!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TaipyGuiBase=t():e.TaipyGuiBase=t()}(this,(()=>(()=>{"use strict";var e,t={1248:(e,t,i)=>{i.r(t),i.d(t,{TaipyApp:()=>y,createApp:()=>m,default:()=>b});var a=i(3561);const n="TaipyClientId",s=(e,t,i)=>{const a=localStorage&&localStorage.getItem(e);return a?i&&-1==i.indexOf(a)?t:a:t},o=new Worker(new URL(i.p+i.u(677),i.b));var r=i(3508);const d=(e,t)=>{e.on("connect",(()=>{t.onWsMessageEvent("connect",null),""!==t.clientId&&""!==t.appId||t.init()})),e.io.on("reconnect",(()=>{t.onWsMessageEvent("reconnect",null),console.log("WebSocket reconnected"),t.sendWsMessage("AID","reconnect",t.appId)})),e.on("connect_error",(i=>{t.onWsMessageEvent("connect_error",{err:i}),console.log("Error connecting WebSocket: ",i),setTimeout((()=>{e&&e.connect()}),500)})),e.on("disconnect",((i,a)=>{t.onWsMessageEvent("disconnect",{reason:i,details:a}),console.log("WebSocket disconnected due to: ",i,a),"io server disconnect"===i&&e&&e.connect()})),e.on("message",(e=>{t.onWsMessageEvent("message",e);for(const i of t.wsAdapters)if(i.supportedMessageTypes.includes(e.type)&&i.handleWsMessage(e,t))return})),e.connected||e.connect()};var c=i(5364),l=i.n(c);class h{constructor(e){this._data={},this._init_data={},this._requested_data={},this.init(e)}init(e){const t={};for(const i in this._init_data)if(i in e)for(const a in this._init_data[i])a in e[i]||(i in t||(t[i]={}),t[i][a]=this._init_data[i][a]);else t[i]=this._init_data[i];0!==Object.keys(t).length&&console.error("Unmatched data tree! Removed changes: ",t),this._init_data=e,this._data={};for(const e in this._init_data)for(const t in this._init_data[e]){const i=this._init_data[e][t];this._data[i.encoded_name]=i.value}return t}getEncodedName(e,t){if(t in this._init_data&&e in this._init_data[t])return this._init_data[t][e].encoded_name}getName(e){for(const t in this._init_data)for(const i in this._init_data[t])if(this._init_data[t][i].encoded_name===e)return[i,t]}get(e,t){if(t){if(!(e in this._requested_data))throw new Error(`Encoded name '${e}' is not available in Taipy GUI`);if(!(t in this._requested_data[e]))throw new Error(`Event key '${t}' is not available for encoded name '${e}' in Taipy GUI`);return this._requested_data[e][t].receivedData}if(!(e in this._data))throw new Error(`${e} is not available in Taipy GUI`);return this._data[e]}addRequestDataOptions(e,t,i){e in this._requested_data||(this._requested_data[e]={}),this._requested_data[e][t]={options:i,receivedData:void 0}}getInfo(e){for(const t in this._init_data)for(const i in this._init_data[t]){const a=this._init_data[t][i];if(a.encoded_name===e)return Object.assign(Object.assign({},a),{value:this._data[e]})}}getDataTree(){return this._init_data}getAllData(){return this._data}update(e,t,i){if(i){if(!(e in this._requested_data))throw new Error(`Encoded name '${e}' is not available in Taipy GUI`);if(!(i in this._requested_data[e]))throw new Error(`Event key '${i}' is not available for encoded name '${e}' in Taipy GUI`);this._requested_data[e][i].receivedData=t}else{if(!(e in this._data))throw new Error(`${e} is not available in Taipy Gui`);this._data[e]=t}}deleteRequestedData(e,t){e in this._requested_data&&t in this._requested_data[e]&&delete this._requested_data[e][t]}}class u{}class p extends u{constructor(){super(),this.supportedMessageTypes=["MU","ID","GMC","GDT","AID","GR","AL","ACK"],this.initWsMessageTypes=["ID","AID","GMC"]}handleWsMessage(e,t){var i,a,s,o;if(e.type){if("MU"===e.type&&Array.isArray(e.payload))for(const n of e.payload){const e=n.name,{value:r}=n.payload;if(r&&void 0!==r.__taipy_refresh){const a=null===(i=t.variableData)||void 0===i?void 0:i._requested_data[e];for(const i in a){const n=a[i],{options:s}=n;t.sendWsMessage("DU",e,s)}return!0}const d=!!(o=n.payload)&&"object"==typeof o&&"pagekey"in o&&o.pagekey||void 0;null===(a=t.variableData)||void 0===a||a.update(e,r,d),d&&e in t._rdc&&d in t._rdc[e]&&((null===(s=t._rdc[e])||void 0===s?void 0:s[d])(t,e,d,r),delete t._rdc[e][d]),t.onChangeEvent(e,r,d)}else if("ID"===e.type){const{id:i}=e;(e=>{localStorage&&localStorage.setItem(n,e)})(i),t.clientId=i,t.initApp(),t.updateContext(t.path)}else if("GMC"===e.type){const i=e.payload;if(t.context=i.context,null==i?void 0:i.metadata)try{t.metadata=JSON.parse(i.metadata||"{}")}catch(e){console.error("Error parsing metadata from Taipy Designer",e)}}else if("GDT"===e.type){const i=e.payload,a=i.variable,n=i.function;if(t.variableData&&t.functionData){const e=t.variableData.init(a),i=t.functionData.init(n),s=l()(e,i);(e||i)&&t.onReloadEvent(s)}else t.variableData=new h(a),t.functionData=new h(n),t.onInitEvent()}else if("AID"===e.type){const i=e.payload;if("reconnect"===i.name)return t.init(),!0;t.appId=i.id}else if("GR"===e.type){const i=e.payload;t.routes=i}else if("AL"===e.type){const i=e;t.onNotifyEvent(i.atype,i.message)}else if("ACK"===e.type){const{id:i}=e;t._ackList=t._ackList.filter((e=>e!==i)),t.onWsStatusUpdateEvent(t._ackList)}return this.postWsMessageProcessing(e,t),!0}return!1}postWsMessageProcessing(e,t){this.initWsMessageTypes.includes(e.type)&&""!==t.clientId&&""!==t.appId&&""!==t.context&&void 0!==t.routes&&t.sendWsMessage("GDT","get_data_tree",{})}}var v=i(1083),g=function(e,t,i,a){return new(i||(i=Promise))((function(n,s){function o(e){try{d(a.next(e))}catch(e){s(e)}}function r(e){try{d(a.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}d((a=a.apply(e,t||[])).next())}))};const f="tprh";class _{constructor(){this.resourceHandlerId=s(f,"")}init(e,t){return g(this,void 0,void 0,(function*(){if(!(yield this.verifyCookieStatus()))return yield this.deleteCookie(),localStorage.removeItem(f),void window.location.reload();this.addBeforeUnloadListener(),d(e,t)}))}verifyCookieStatus(){return g(this,void 0,void 0,(function*(){if(!this.resourceHandlerId)return new Promise((e=>e(!1)));try{const{data:e}=yield v.A.get("taipy-rh");if((null==e?void 0:e.rh_id)!==this.resourceHandlerId)return new Promise((e=>e(!1)))}catch(e){return console.error("Error while validating cookie:",e),new Promise((e=>e(!1)))}return new Promise((e=>e(!0)))}))}addBeforeUnloadListener(){window.addEventListener("beforeunload",(()=>{localStorage.removeItem(f),this.deleteCookie()}))}deleteCookie(){return g(this,void 0,void 0,(function*(){yield v.A.delete("taipy-rh")}))}}class y{constructor(e=void 0,t=void 0,i=void 0,a=void 0,n=!0){var s;a=a||(0,r.io)("/",{autoConnect:!1,path:`${this.getBaseUrl()}socket.io`}),this.onInit=e,this.onChange=t,this.variableData=void 0,this.functionData=void 0,this.clientId="",this.context="",this.metadata={},this.appId="",this.routes=void 0,this.path=i,this.socket=a,this.wsAdapters=[new p],this._ackList=[],this._rdc={},this._cookieHandler=n?new _:void 0,this._cookieHandler?null===(s=this._cookieHandler)||void 0===s||s.init(a,this):d(a,this)}get onInit(){return this._onInit}set onInit(e){if(void 0!==e&&1!==e.length)throw new Error("onInit() requires one parameter");this._onInit=e}onInitEvent(){this.onInit&&this.onInit(this)}get onChange(){return this._onChange}set onChange(e){if(void 0!==e&&3!==e.length&&4!==e.length)throw new Error("onChange() requires three or four parameters");this._onChange=e}onChangeEvent(e,t,i){this.onChange&&this.onChange(this,e,t,i)}get onNotify(){return this._onNotify}set onNotify(e){if(void 0!==e&&3!==e.length)throw new Error("onNotify() requires three parameters");this._onNotify=e}onNotifyEvent(e,t){this.onNotify&&this.onNotify(this,e,t)}get onReload(){return this._onReload}set onReload(e){if(void 0!==e&&2!==(null==e?void 0:e.length))throw new Error("onReload() requires two parameters");this._onReload=e}onReloadEvent(e){this.onReload&&this.onReload(this,e)}get onWsMessage(){return this._onWsMessage}set onWsMessage(e){if(void 0!==e&&3!==(null==e?void 0:e.length))throw new Error("onWsMessage() requires three parameters");this._onWsMessage=e}onWsMessageEvent(e,t){this.onWsMessage&&this.onWsMessage(this,e,t)}get onWsStatusUpdate(){return this._onWsStatusUpdate}set onWsStatusUpdate(e){if(void 0!==e&&2!==(null==e?void 0:e.length))throw new Error("onWsStatusUpdate() requires two parameters");this._onWsStatusUpdate=e}onWsStatusUpdateEvent(e){this.onWsStatusUpdate&&this.onWsStatusUpdate(this,e)}init(){this.clientId="",this.context="",this.appId="",this.routes=void 0;const e=s(n,"");this.sendWsMessage("ID",n,e),""!==e&&(this.clientId=e,this.initApp(),this.updateContext(this.path))}initApp(){this.sendWsMessage("AID","connect",""),this.sendWsMessage("GR","","")}sendWsMessage(e,t,i,n=void 0){void 0===n&&(n=this.context);const s=((e,t,i,n,s,o="",r=!0,d)=>{const c=(0,a.Ak)(),l={type:t,name:i,payload:n,propagate:r,client_id:s,ack_id:c,module_context:o};return null==e||e.emit("message",(e=>Object.keys(e||{}).reduce(((t,i)=>(void 0!==e[i]&&(t[i]=e[i]),t)),{}))(l),d),c})(this.socket,e,t,i,this.clientId,n);s&&(this._ackList.push(s),this.onWsStatusUpdateEvent(this._ackList))}registerWsAdapter(e){this.wsAdapters.unshift(e)}getEncodedName(e,t){var i;return null===(i=this.variableData)||void 0===i?void 0:i.getEncodedName(e,t)}getName(e){var t;return null===(t=this.variableData)||void 0===t?void 0:t.getName(e)}get(e,t){var i;return null===(i=this.variableData)||void 0===i?void 0:i.get(e,t)}getInfo(e){var t;return null===(t=this.variableData)||void 0===t?void 0:t.getInfo(e)}getDataTree(){var e;return null===(e=this.variableData)||void 0===e?void 0:e.getDataTree()}getAllData(){var e;return null===(e=this.variableData)||void 0===e?void 0:e.getAllData()}getFunctionList(){var e;const t=null===(e=this.functionData)||void 0===e?void 0:e.getDataTree()[this.context];return Object.keys(t||{})}getRoutes(){return this.routes}deleteRequestedData(e,t){var i;null===(i=this.variableData)||void 0===i||i.deleteRequestedData(e,t)}update(e,t){this.sendWsMessage("U",e,{value:t})}requestData(e,t,i){var n;const s=this.getInfo(e);if(!(null==s?void 0:s.data_update))throw new Error(`Cannot request data for ${e}. Not supported for type of ${null==s?void 0:s.type}`);i||(i={pagekey:(0,a.Ak)(10)}),i.pagekey=(null==i?void 0:i.pagekey)||(0,a.Ak)(10);const o=i.pagekey;null===(n=this.variableData)||void 0===n||n.addRequestDataOptions(e,o,i),this._rdc[e]=Object.assign(Object.assign({},this._rdc[e]),{[o]:t}),this.sendWsMessage("DU",e,i)}getContext(){return this.context}updateContext(e=""){e&&""!==e||(e=window.location.pathname.replace(this.getBaseUrl(),"")||"/"),this.sendWsMessage("GMC","get_module_context",{path:e||"/"})}trigger(e,t,i={}){i.action=e,this.sendWsMessage("A",t,i)}upload(e,t,i){return((e,t,i,a,n,s,r,d="/taipy-uploads")=>new Promise(((c,l)=>{o.onmessage=e=>{e.data.error?l(e.data.message):e.data.done?c(e.data.message):s(e.data.progress)},o.onerror=e=>l(e),o.postMessage({files:n,uploadUrl:d,varName:e,context:t,onAction:i,uploadData:a,id:r})})))(e,void 0,void 0,void 0,t,i,this.clientId)}getPageMetadata(){return this.metadata}getWsStatus(){return this._ackList}getBaseUrl(){return document.getElementsByTagName("base")[0].getAttribute("href")||"/"}}const m=(e,t,i,a,n)=>new y(e,t,i,a,n),b=y}},i={};function a(e){var n=i[e];if(void 0!==n)return n.exports;var s=i[e]={id:e,loaded:!1,exports:{}};return t[e](s,s.exports,a),s.loaded=!0,s.exports}a.m=t,e=[],a.O=(t,i,n,s)=>{if(!i){var o=1/0;for(l=0;l<e.length;l++){for(var[i,n,s]=e[l],r=!0,d=0;d<i.length;d++)(!1&s||o>=s)&&Object.keys(a.O).every((e=>a.O[e](i[d])))?i.splice(d--,1):(r=!1,s<o&&(o=s));if(r){e.splice(l--,1);var c=n();void 0!==c&&(t=c)}}return t}s=s||0;for(var l=e.length;l>0&&e[l-1][2]>s;l--)e[l]=e[l-1];e[l]=[i,n,s]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.u=e=>e+".taipy-gui-base.js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=i[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{a.b=document.baseURI||self.location.href;var e={818:0};a.O.j=t=>0===e[t];var t=(t,i)=>{var n,s,[o,r,d]=i,c=0;if(o.some((t=>0!==e[t]))){for(n in r)a.o(r,n)&&(a.m[n]=r[n]);if(d)var l=d(a)}for(t&&t(i);c<o.length;c++)s=o[c],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(l)},i=this.webpackChunkTaipyGuiBase=this.webpackChunkTaipyGuiBase||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var n=a.O(void 0,[804],(()=>a(1248)));return a.O(n)})()));