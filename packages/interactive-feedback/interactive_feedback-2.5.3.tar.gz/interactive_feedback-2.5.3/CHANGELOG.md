# 更新日志 (Changelog)

## [v2.5.3] - 2025-06-15

### 🎉 重大功能更新
#### 对话历史记录系统
- **新增功能**：完整的对话历史记录系统，自动记录和管理AI助手与用户的对话历史
- **智能会话管理**：基于时间间隔、任务切换等智能判断会话边界，自动创建新会话
- **历史查看界面**：专用的对话历史记录窗口，支持展开/折叠查看详细内容
- **实时搜索过滤**：支持关键词搜索，快速找到相关对话内容
- **窗口尺寸记忆**：对话历史窗口会记住用户调整的大小和位置，下次打开时自动恢复
- **清除管理功能**：左下角"清除全部"按钮，支持一键清除所有历史记录，带确认提示防止误操作
- **智能存储限制**：自动维护最多50组会话记录，超出时自动删除最旧的记录
- **数据持久化**：所有对话记录以JSON格式本地存储，支持跨会话保持和恢复

#### 界面优化改进
- **移除冗余信息**：去除对话详情中的"显示模式"信息显示，界面更加简洁
- **按钮布局优化**：对话历史窗口采用左右分布的按钮布局，操作更加直观
- **主题一致性**：对话历史记录界面完全适配深色/浅色主题切换

### 🔧 技术架构优化
#### 代码质量提升
- **配置常量化**：将硬编码的数量限制提取为 `MAX_SESSIONS_LIMIT = 50` 常量，提高可维护性
- **通用方法提取**：添加通用的确认对话框和刷新显示方法，减少代码重复
- **模块化设计**：将复杂逻辑拆分为多个职责单一的小方法，提高代码可读性
- **异常处理优化**：统一异常处理模式，提高系统稳定性

#### 存储系统完善
- **会话存储管理**：完整的会话存储、索引和元数据管理系统
- **数据结构优化**：标准化的会话记录和对话记录数据结构
- **自动清理机制**：智能的存储空间管理和过期数据清理

### 📚 文档体系更新
#### 功能文档完善
- **功能说明.md**：新增对话历史记录系统的完整描述，包括技术架构和数据结构说明
- **README.md**：添加对话历史记录的使用技巧和操作指南，更新项目简介突出功能完整性
- **结构优化**：修正文档章节编号，保持逻辑清晰的内容组织

#### 用户指导改进
- **使用技巧**：详细的对话历史记录使用指南，包括7个核心功能点的操作说明
- **技术细节**：完整的技术实现描述和配置管理说明
- **用户友好性**：突出实用的使用技巧，提供清晰的操作指导

### 🎯 用户体验提升
- **操作直观性**：简化的界面布局和清晰的功能分区
- **功能完整性**：从基础反馈工具发展为功能完整的AI助手交互平台
- **稳定可靠性**：完善的错误处理和异常保护机制
- **性能优化**：优化的代码结构和资源管理

---

## [最新更新] - 2025-01-12

### 🔧 重要修复
#### MCP服务连续调用问题修复
- **问题描述**：修复了MCP服务连续调用两次的问题，原因是严格的参数验证逻辑导致第一次调用失败
- **解决方案**：实现智能回退机制，当主要参数为空时自动使用备用参数
- **技术改进**：
  - 完整模式：优先使用 `full_response`，如果为空则回退到 `message`
  - 精简模式：优先使用 `message`，如果为空则回退到 `full_response`
  - 只有当两个参数都为空时才返回错误
  - 保持实时模式检测，支持动态切换
- **代码优化**：
  - 提取公共参数验证函数，减少重复代码
  - 使用元组解包简化参数优先级逻辑
  - 更新工具文档，添加智能回退说明
- **用户体验**：避免了不必要的错误提示，提升了工具的稳定性和可靠性

---

## [当前版本] - 项目现状

### 🎯 项目概述
interactive-feedback-mcp 是一个专业的AI助手交互式反馈工具，提供图形化界面用于AI助手与用户之间的高效沟通。

### 🌟 核心功能
- **交互式反馈窗口**：支持文本输入、预定义选项选择、快捷键操作
- **多媒体处理**：图片粘贴/拖拽、文件引用、窗口截图功能
- **常用语管理**：预设管理、hover预览、快速插入
- **原生终端集成**：支持PowerShell、Git Bash、Command Prompt
- **文本优化功能**：多AI提供商支持、一键优化、自定义增强
- **界面布局**：垂直/水平布局、可拖拽分割器、主题切换
- **显示模式**：简单模式/完整模式、实时切换
- **音频提示**：窗口弹出提示音、自定义音频支持

### 🏗️ 技术架构
- **基于PySide6**：现代化的Qt图形界面框架
- **MCP协议**：标准的模型上下文协议集成
- **模块化设计**：清晰的代码结构和组件分离
- **主题系统**：统一的颜色管理和样式应用
- **配置管理**：灵活的配置文件和UI设置

### 📚 文档体系
- **README.md**：项目简介和使用技巧
- **功能说明.md**：详细的功能描述和操作指南
- **安装与配置指南.md**：完整的安装配置说明
- **CHANGELOG.md**：项目发展历程记录

---

## [主要版本历程]

### v4.x - 界面优化与文档重构期
#### UI界面稳定性提升
- 解决了UI窗口布局闪烁问题，优化初始化流程
- 实现主题一致性，所有UI元素统一使用主题感知颜色系统
- 调整按钮布局逻辑，提升用户操作体验
- 移除不协调的hover效果，保持视觉一致性

#### 代码质量改进
- 清理约50行冗余代码，统一配置读取和样式应用逻辑
- 优化初始化流程，减少定时器冲突，提升UI响应性
- 改进窗口显示和样式更新时序，提供更稳定的用户体验

#### 文档体系重构
- 重构README.md，突出使用技巧，更新AI助手工作流规则
- 精简功能说明.md，移除时间性描述，突出核心功能
- 优化安装与配置指南.md，移除重复内容，保持文档简洁

### v3.x - 功能扩展与体验优化期
#### 文本优化功能
- 集成多AI提供商支持（OpenAI、Gemini、DeepSeek、火山引擎）
- 实现一键优化和自定义增强功能
- 添加API密钥管理和加载动画
- 支持撤销功能和自动光标定位

#### 多媒体功能增强
- 添加窗口截图功能，支持矩形选择和智能窗口管理
- 实现音频提示功能，支持自定义音频文件
- 优化图片处理流程，提供更好的预览和管理体验

#### 界面布局系统
- 实现垂直/水平双布局模式
- 添加可拖拽分割器，支持双击重置
- 实现显示模式配置（简单模式/完整模式）
- 优化设置页面，统一UI风格

### v2.x - 核心功能完善期
#### 文件处理系统
- 实现文件拖拽功能，支持蓝色文件引用显示
- 添加文件选择按钮，支持多文件选择
- 智能处理图片文件和普通文件
- 实现智能光标定位和重复检测

#### 常用语系统
- 实现常用语管理功能，支持添加、编辑、删除和排序
- 添加hover预览功能，支持无限滚动
- 实现流畅的鼠标交互和主题适配
- 优化管理界面布局和用户体验

#### 终端集成
- 集成原生终端功能，支持PowerShell、Git Bash、Command Prompt
- 实现直接输入模式和完整键盘支持
- 添加ANSI转义序列支持，正确显示彩色输出
- 实现智能提示符识别和窗口管理

### v1.x - 基础功能建立期
#### 核心反馈系统
- 建立基础的交互式反馈窗口
- 实现文本输入和预定义选项选择
- 添加快捷键支持（Enter、Shift+Enter、Ctrl+V）
- 集成MCP协议，实现与AI助手的通信

#### 图片处理功能
- 实现图片粘贴和拖拽功能
- 添加图片预览和管理功能
- 支持多种图片格式和尺寸调整
- 实现图片与文本的混合处理

#### 基础UI框架
- 建立基于PySide6的图形界面框架
- 实现深色主题UI
- 添加基础的窗口控制功能
- 建立配置管理系统

---

## [发展里程碑]

### 🎯 项目成就
- **功能完整性**：从基础反馈工具发展为功能完整的AI助手交互平台
- **用户体验**：持续优化界面和交互，提供专业级的用户体验
- **技术架构**：建立了稳定、可扩展的技术架构
- **文档体系**：完善的文档体系，便于用户使用和开发者参与

### 🔮 技术演进
- **界面技术**：从基础Qt界面发展为主题感知的现代化UI
- **功能集成**：从单一反馈功能扩展为多媒体、终端、AI优化的综合平台
- **代码质量**：持续重构和优化，保持高质量的代码标准
- **用户导向**：始终以用户体验为中心，不断改进和完善功能
