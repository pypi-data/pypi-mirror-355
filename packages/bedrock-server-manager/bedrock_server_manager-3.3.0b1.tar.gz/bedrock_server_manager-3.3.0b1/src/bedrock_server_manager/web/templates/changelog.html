{# bedrock_server_manager/web/templates/changelog.html #}
{% extends "base.html" %}

{# --- Page Title --- #}
{% block title %}Changelog - {{ super() }}{% endblock %}

{# --- Page Specific Styles --- #}
{% block head_styles %}
{{ super() }} {# Include styles from base's head_styles block if any are defined there #}
<style>
    .changelog-container {
        /* Content will inherit padding/styles from the main .container in base.html */
        /* This class is mostly for semantic grouping now */
    }

        .changelog-container h1 { /* Main Page Title */
            margin-bottom: 0.8em;
            padding-bottom: 0.5em; /* Added padding */
            border-bottom: 1px solid #666; /* Added border */
            font-size: 2em;
            color: #eee; /* Ensure color consistency */
        }

        .changelog-container h2 { /* Version Number */
            margin-top: 2em;
            margin-bottom: 0.8em;
            padding-bottom: 0.4em;
            border-bottom: 1px solid #666; /* Slightly darker/thicker than h1 border */
            font-size: 1.6em;
            color: #ededed;
        }

        .changelog-container h3 { /* Section Title (like Bash vs Python) */
            margin-top: 1.8em;
            margin-bottom: 0.8em;
            font-size: 1.4em;
            color: #e0e0e0;
            border-bottom: 1px dotted #555;
            padding-bottom: 0.3em;
        }

        .changelog-container h4 { /* Subsection Title */
            margin-top: 1.5em;
            margin-bottom: 0.6em;
            font-size: 1.2em;
            color: #dcdcdc;
        }

        .changelog-container p { /* Style paragraphs for consistency */
            margin-bottom: 1em;
            line-height: 1.6;
            color: #eee; /* Ensure consistent text color */
        }

        .changelog-container ol,
        .changelog-container ul {
            margin-left: 25px; /* Indentation */
            margin-bottom: 1.5em;
            padding-left: 15px; /* Add padding for list marker */
            color: #eee; /* Ensure consistent text color */
        }
            /* Deeper nesting indentation */
            .changelog-container ul ul,
            .changelog-container ul ol,
            .changelog-container ol ul,
            .changelog-container ol ol {
                margin-left: 20px; /* Additional indent for nested lists */
                margin-top: 0.5em; /* Space above nested list */
                margin-bottom: 0.8em; /* Space below nested list */
            }


        .changelog-container li {
            margin-bottom: 0.6em;
            line-height: 1.5;
        }

        .changelog-container code { /* Inline code */
            background-color: #4a4a4a;
            padding: 0.2em 0.4em;
            border-radius: 0; /* Keep sharp corners */
            font-size: 0.9em;
            font-family: "Consolas", "Monaco", "Courier New", monospace;
            color: #f0f0f0;
            word-break: break-word; /* Allow long code to wrap if needed */
        }

    /* Style for the back link */
    .back-to-docs-link {
        display: inline-block; /* Or block if you want it on its own line */
        margin-bottom: 1.5em;
        font-size: 0.95em;
    }

        .back-to-docs-link a {
            color: #90CAF9;
            text-decoration: none;
        }

            .back-to-docs-link a:hover {
                color: #BBDEFB;
                text-decoration: underline;
            }

    /* Optional: Ensure hr has consistent styling */
    .changelog-container hr {
        border: 0;
        height: 1px;
        background-color: #555;
        margin: 2em 0;
    }

    /* Responsive adjustments (complement base CSS) */
    @media (max-width: 768px) {
        .changelog-container h1 {
            font-size: 1.8em;
        }

        .changelog-container h2 {
            font-size: 1.45em;
            margin-top: 1.8em;
        }

        .changelog-container h3 {
            font-size: 1.3em;
            margin-top: 1.6em;
        }

        .changelog-container h4 {
            font-size: 1.15em;
            margin-top: 1.4em;
        }

        .changelog-container ol,
        .changelog-container ul {
            margin-left: 20px;
            padding-left: 10px;
        }
    }

    @media (max-width: 480px) {
        .changelog-container h1 {
            font-size: 1.6em;
        }

        .changelog-container h2 {
            font-size: 1.3em;
            margin-top: 1.6em;
        }

        .changelog-container h3 {
            font-size: 1.2em;
            margin-top: 1.5em;
        }

        .changelog-container h4 {
            font-size: 1.1em;
            margin-top: 1.3em;
        }

        .changelog-container ol,
        .changelog-container ul {
            margin-left: 15px;
            padding-left: 10px;
        }

        .changelog-container code {
            font-size: 0.85em;
        }
    }
</style>
{% endblock %}


{# --- Main Content --- #}
{% block content %}
<div class="changelog-container">

    <h1>Bedrock Server Manager Changelog</h1>

    {# --- Link back to the Documentation Index --- #}
    <p class="back-to-docs-link">
        <a href="{{ url_for('doc_routes.doc_index') }}">← Back to Documentation Index</a>
    </p>

    {# --- Version 3.3.0 --- #}
    <h2>Version 3.3.0</h2>
    <h4>MAJOR BREAKING CHANGES: READ FULL CHANGELOG BEFORE UPDATING</h4>
    <h4>STOP SERVERS BEFORE UPDATING</h4>

    <p>
        Start/Stop methods have been revamped and require servers to be restarted with the new method.
        If you update before turning off your servers, you may need to manually terminate the running process.
    </p>

    <ol>
        <li>
            <strong>Revamped start server actions</strong>
            <ul>
                <li>
                    Windows:
                    <ul>
                        <li>Starting a server now creates a named pipe in the background, allowing commands to be sent to the server.</li>
                    </ul>
                </li>
                <li>
                    Linux:
                    <ul>
                        <li>Start remains mostly the same, but the systemd command has also been merged into the base server start command.</li>
                    </ul>
                </li>
                <li>
                    Now takes an optional <code>-m</code>/<code>--mode</code> variable in the server start command:
                    <ul>
                        <li>
                            Windows:
                            <ul>
                                <li><code>detached</code> mode will start a named pipe process in the background (similar to web start).</li>
                                <li><code>direct</code> mode will start the named pipe process in the foreground (similar to web start).</li>
                            </ul>
                        </li>
                        <li>
                            Linux:
                            <ul>
                                <li><code>detached</code> mode will try to start the server with systemctl. If the service file doesn't exist, it falls back to direct mode.</li>
                                <li><code>direct</code> mode will start the server directly with screen.</li>
                                <li>Systemd files must be recreated (use the "Reconfigure autoupdate/service" menu option).</li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li>
                    Removed systemd-specific start/stop methods.
                </li>
            </ul>
        </li>
        <li>
            <strong>Added reset-world action</strong>
            <ul>
                <li>Deletes the server’s world folder.</li>
            </ul>
        </li>
        <li>
            <strong>Cleaned up various background code such as:</strong>
            <ul>
                <li>Removed the old BedrockServer class as it was underutilized.</li>
                <li>Revamped the <code>core.server_actions.delete_server_data</code> function.</li>
                <li>Split and renamed various files for better organization.</li>
                <li>Removed redundant core backup/restore functions as the API layer can now call config/world functions directly.</li>
            </ul>
        </li>
        <li>
            <strong>Fixed stop-web-server killing any process that happened to match the PID saved in the file.</strong>
            <ul>
                <li>It now validates that it is the bedrock-server-manager process being killed.</li>
            </ul>
        </li>
        <li>
            <strong>Send command support for various actions</strong> such as sending messages to running servers when shutting down or reloading the allowlist/configurations when changed.
        </li>
        <li>
            <strong>Changed list-backups function</strong>
            <ul>
                <li>The <code>--type</code> option for backups changed from <code>config</code> to more specific types: <code>allowlist</code>, <code>properties</code>, and <code>permissions</code>.</li>
            </ul>
        </li>
        <li>
            <strong>CLI and FILE log levels now use separate values.</strong>
            <ul>
                <li>Set <code>CLI_LOG_LEVEL</code> and <code>FILE_LOG_LEVEL</code> in <code>script_config.json</code>.</li>
            </ul>
        </li>
        <li>
            <strong>Refactored <code>core.downloader</code> into a <code>BedorckDownloader</code> class.</strong>
        </li>
        <li>
            <strong>Refactored some global core functions into a <code>BedrockServerManager</code> class.</strong>
            <ul>
                <li>Some functions migrated to this class include: Scan for players, List content files, Start web server, and List all servers.</li>
            </ul>
        </li>
        <li>
            <strong>Reintroduced the BedrockServer class in a more capable, feature-complete form.</strong>
        </li>
        <li>
            <strong>Moved main <code>__init__.py</code> to <code>__main__.py</code>.</strong>
            <ul>
                <li>Allows running the app with <code>python -m bedrock_server_manager <command></code>.</li>
                <li>This makes some logic easier, as only <code>sys.executable</code> is needed instead of manually finding the <code>bedrock-server-manager(.exe)</code> in various installation paths.</li>
            </ul>
        </li>
        <li>
            <strong>Migrated task schedulers to their own classes, reducing redundant logic.</strong>
        </li>
        <li>
            <strong>BREAKING CHANGE: Revamped all CLI modules.</strong> All CLI commands, systemd services, and task scheduler commands need to be removed/recreated.
            <ul>
                <li>Please see the updated <code>CLI_COMMANDS.md</code> document for an updated list of commands.</li>
                <li>A few commands were removed and may or may not be replaced with new commands in the future.</li>
            </ul>
        </li>
        <li>Removed getting started guide and extras from web server</li>
    </ol>

    {# --- Version 3.2.5 --- #}
    <h2>Version 3.2.5</h2>
    <ol>
        <li>Fix download server function to use updated minecraft site</li>
    </ol>

    {# --- Version 3.2.4 --- #}
    <h2>Version 3.2.4</h2>
    <ol>
        <li>Fix restart-server command in CLI</li>
    </ol>

    {# --- Version 3.2.3 --- #}
    <h2>Version 3.2.3</h2>
    <ol>
        <li>
            Added /api/server/{server_name}/backups/list/{type} route
            <ul>
                <li>List all backups of one type for a server</li>
            </ul>
        </li>
        <li>
            Added /api/content/worlds route
            <ul>
                <li>List all worlds in the content folder</li>
            </ul>
        </li>
        <li>
            Added /api/content/addons route
            <ul>
                <li>List all addons in the content folder</li>
            </ul>
        </li>
        <li>
            Added /api/players/get route
            <ul>
                <li>List all players in the global players.json file</li>
            </ul>
        </li>
        <li>
            Added /api/players/add route
            <ul>
                <li>Add players to the global players.json file</li>
            </ul>
        </li>
        <li>
            Added /api/server/{server_name}/permissions_data
            <ul>
                <li>List all players in the server permissions file</li>
            </ul>
        </li>
        <li>
            File path for backups in http restore api must now be relative to the servers backup folder
        </li>
        <li>
            Folder path for download prune in http prune api must now be relative to the download folder
        </li>
        <li>
            /api/servers/{server_name}/ routes are now /api/server/{server_name}
            <ul>
                <li>Only the read properties route should be affected</li>
            </ul>
        </li>
        <li>Fixed passing host arument to web server</li>

    </ol>

    {# --- Version 3.2.2 --- #}
    <h2>Version 3.2.2</h2>
    <ol>
        <li>Fixed wrong module for read server properties route</li>
    </ol>

    {# --- Version 3.2.1 --- #}
    <h2>Version 3.2.1</h2>
    <ol>
        <li>Added /api/info route</li>
        <li>Added /api/server/{server_name}/read_properties route</li>
        <li>Stop server before export world</li>
    </ol>

    {# --- Version 3.2.0 --- #}
    <h2>Version 3.2.0</h2>
    <ol>
        <li>
            Added export world to web GUI
            <ul>
                <li>Refactored export world endpoint</li>
                <li>export-world on web and cli now export to the content folder</li>
            </ul>
        </li>
        <li>
            Added remove player from allowlist to web and cli
            <ul>
                <li>Added <code>remove-allowlist-player</code> command</li>
            </ul>
        </li>
        <li>Added a blacklist for commands such as stop or allowlist off</li>
        <li>Added more splash text</li>
    </ol>

    {# --- Version 3.1.4 --- #}
    <h2>Version 3.1.4</h2>
    <ol>
        <li>
            Revised HTTP docs included with web server
            <ul>
                <li>Only includes basic api info, full detailed docs can be found in the docs folder of the repository</li>
            </ul>
        </li>
        <li>
            Added /api/servers endpoint
            <ul>
                <li>Returns a list of all servers and their status</li>
            </ul>
        </li>
    </ol>

    {# --- Version 3.1.3 --- #}
    <h2>Version 3.1.3</h2>
    <ol>
        <li>Revised docs included with web server</li>
    </ol>

    {# --- Version 3.1.2 --- #}
    <h2>Version 3.1.2</h2>
    <ol>
        <li>Fixed wrong longer in some js files</li>
        <li>Fixed allowlist configuration on web</li>
        <li>Fixed restoring backups on web</li>
        <li>Fixed warning about jwt token for web sessions</li>
    </ol>

    {# --- Version 3.1.1 --- #}
    <h2>Version 3.1.1</h2>
    <ol>
        <li>Fixed missing js files and images for web server</li>
        <li>Added missing <code>generate-password</code> command</li>
        <li>Fixed <code>manage-script-config</code> command</li>
    </ol>

    {# --- Version 3.1.0 --- #}
    <h2>Version 3.1.0</h2>
    <ol>
        <li>
            <strong>Added Web Server</strong>
            <ul>
                <li>
                    Environment Variables:
                    <dl>
                        <dt><code>BEDROCK_SERVER_MANAGER_USERNAME</code></dt>
                        <dd>Required. Plain text username for web UI and API login.</dd>

                        <dt><code>BEDROCK_SERVER_MANAGER_PASSWORD</code></dt>
                        <dd>Required. Hashed password for web UI and API login. Use the <code>generate-password</code> utility.</dd>

                        <dt><code>BEDROCK_SERVER_MANAGER_SECRET</code></dt>
                        <dd>Strongly Recommended (Effectively Required for Web UI). A long, random, secret string. If not set, a temporary key is generated, and web UI sessions will not persist across restarts.</dd>

                        <dt><code>BEDROCK_SERVER_MANAGER_TOKEN</code></dt>
                        <dd>Strongly Recommended. A long, random, secret string (different from <code>_SECRET</code>). If not set, a temporary key is generated, and JWT tokens used for API authentication will become invalid across restarts. JWT tokens expire every 4 weeks by default.</dd>
                    </dl>
                </li>
                <li>
                    Configuration:
                    <ul>
                        <li>Set port in <code>script_config.json</code>: <code>WEB_PORT</code> (Defaults to <code>11325</code>)</li>
                        <li>Customizable panorama: Save any jpeg as <code>panorama.jpeg</code> in <code>./.config</code></li>
                    </ul>
                </li>
                <li>
                    Deployment & Tech:
                    <ul>
                        <li>It's recommended to run this behind a reverse proxy of your choice (NGINX, CADDY, etc.).</li>
                        <li>Uses Waitress WSGI server.</li>
                    </ul>
                </li>
                <li>Mobile friendly experience</li>
            </ul>
        </li>
        <li>
            <strong>Added <code>generate-password</code> command</strong>
            <ul>
                <li>Used to generate a hash to set as the <code>BEDROCK_SERVER_MANAGER_PASSWORD</code> Environment Variable.</li>
            </ul>
        </li>
        <li>
            <strong>Added <code>start-web-server</code> command</strong>
            <ul>
                <li>
                    Command Arguments:
                    <dl>
                        <dt><code>-d | --debug</code></dt>
                        <dd>Runs the server using the Flask debug server. <strong>Not recommended for production.</strong></dd>

                        <dt><code>-m | --mode [direct|detached]</code></dt>
                        <dd>
                            Sets which mode to run the server:
                            <ul>
                                <li><code>direct</code>: Directly runs the web server in the foreground.</li>
                                <li><code>detached</code>: Runs the web server in a separate background process.</li>
                            </ul>
                        </dd>

                        <dt><code>-H | --host <hostname></code></dt>
                        <dd>Specifies which host to listen on.</dd>
                    </dl>
                </li>
            </ul>
        </li>
        <li>
            <strong>Added <code>stop-web-server</code> command</strong>
            <ul>
                <li>Stops a detached web server process.</li>
            </ul>
        </li>
        <li>Removed all related lingering configuration (Linux only).</li>
        <li>Refactored <code>cli.py</code> and <code>handlers.py</code> into <code>cli/</code> and <code>api/</code> modules.</li>
        <li>Added more detailed logging throughout code.</li>
        <li>Added more detailed docstrings/comments throughout code.</li>
        <li>Added HTML docs which cover the HTTP APIs, CLI environment, and user guide.</li>
        <li>Removed redundant commands.</li>
        <li>Added <code>WEB_PORT</code> and <code>TOKEN_EXPIRE_WEEKS</code> to <code>script_config.json</code>.</li>
        <li>Added various documentation accessible in the web server.</li>
        <li>Added splash text to Main Menu in CLI.</li>
        <li>SEMI-BREAKING CHANGE: Changed data dir, you must add the bedrock-server-manager folder in the environment variable path if upgrading from older 3.0 versions.</li>
    </ol>

    {# --- Version 3.0.3 --- #}
    <h2>Version 3.0.3</h2>
    <ol>
        <li>Fixed Linux resource usage monitor</li>
        <li>Fixed Linux systemd enable/disable</li>
    </ol>

    {# --- Version 3.0.2 --- #}
    <h2>Version 3.0.2</h2>
    <ol>
        <li>Fixed <code>EXPATH</code> variable in Linux scheduler</li>
        <li>Fixed Modify Windows Task</li>
    </ol>

    {# --- Version 3.0.1 --- #}
    <h2>Version 3.0.1</h2>
    <ol>
        <li>
            Added handlers module
            <ul><li>Refactored cli to use handlers</li></ul>
        </li>
        <li>
            Refactored settings module
            <ul><li>Migrated settings to a class</li></ul>
        </li>
        <li>Fixed logger variables</li>
        <li>
            [WIP] Send command support for Windows
            <ul>
                <li>Requires <code>pywin32</code> module to be installed</li>
                <li>Requires seperate start method not currently available</li>
            </ul>
        </li>
    </ol>

    {# --- Version 3.0.0 --- #}
    <h2>Version 3.0.0</h2>
    <ol>
        <li>
            BREAKING CHANGE: Completely refactored .py script to a pip package
            <ul><li>Now installed/updated with <code>pip</code> command</li></ul>
        </li>
        <li>
            Use <code>BEDROCK_SERVER_MANAGER_DATA_DIR</code> Environment Variable for default data location
            <ul>
                <li>Defaults to <code>$HOME/bedrock-server-manager</code> if variable doesnt exist</li>
                <li>Follow your platforms documentation for setting Environment Variables</li>
            </ul>
        </li>
        <li>
            Logging refactored to use standard python logging
            <ul><li>Most functions now raise Exceptions instead of returning an error code</li></ul>
        </li>
        <li>Removed <code>windows-start</code>/<code>stop</code> commands</li>
        <li>Added new commands</li>
        <li>
            The following variables were added to <code>script_config.json</code>
            <ul>
                <li><code>CONTENT_DIR</code></li>
                <li><code>DOWNLOAD_DIR</code></li>
                <li><code>BACKUP_DIR</code></li>
                <li><code>LOG_DIR</code></li>
                <li><code>LOGS_KEEP</code></li>
                <li><code>LOG_LEVEL</code></li>
            </ul>
        </li>
    </ol>

    {# --- Optional: Back link at the bottom --- #}
    <hr> {# Consistent hr styling applied via CSS #}
    <p class="back-to-docs-link">
        <a href="{{ url_for('doc_routes.doc_index') }}">← Back to Documentation Index</a>
    </p>

</div> {# End .changelog-container #}
{% endblock %}

{# --- Page Specific Body Scripts (Optional) --- #}
{% block body_scripts %}
{{ super() }}
    {# Add any JS specific to the changelog page if needed #}
{% endblock %}