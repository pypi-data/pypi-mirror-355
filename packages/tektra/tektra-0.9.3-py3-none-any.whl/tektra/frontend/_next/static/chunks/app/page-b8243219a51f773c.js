(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3737:(e,r,t)=>{"use strict";t.d(r,{default:()=>j});var s=t(5155),a=t(2115),n=t(2085),o=t(2596),l=t(9688);function i(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,l.QP)((0,o.$)(r))}let c=(0,n.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,r)=>{let{className:t,variant:a,size:n,...o}=e;return(0,s.jsx)("button",{className:i(c({variant:a,size:n,className:t})),ref:r,...o})});d.displayName="Button";let u=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("textarea",{className:i("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...a})});u.displayName="Textarea";let m=(0,n.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function g(e){let{className:r,variant:t,...a}=e;return(0,s.jsx)("div",{className:i(m({variant:t}),r),...a})}var f=t(5657),x=t(1007),h=t(2486),p=t(8979),y=t(9588),v=t(136),b=t(4355);function j(e){let{className:r}=e,[t,n]=(0,a.useState)([]),[o,l]=(0,a.useState)(""),[i,c]=(0,a.useState)(!1),[m,j]=(0,a.useState)(!1),[w,N]=(0,a.useState)(!1),[k,S]=(0,a.useState)(!1),[_,E]=(0,a.useState)("loading"),[A,O]=(0,a.useState)({progress:0,message:""}),D=(0,a.useRef)(null),P=(0,a.useRef)(null),C=(0,a.useRef)(null),T=(0,a.useRef)(null),W=()=>{var e;null==(e=D.current)||e.scrollIntoView({behavior:"smooth"})};(0,a.useEffect)(()=>{W()},[t]),(0,a.useEffect)(()=>(R(),F(),()=>{T.current&&T.current.close()}),[]);let R=()=>{try{let e="https:"===window.location.protocol?"wss:":"ws:",r="".concat(e,"//").concat(window.location.host,"/ws");T.current=new WebSocket(r),T.current.onopen=()=>{N(!0),console.log("WebSocket connected")},T.current.onmessage=e=>{try{let r=JSON.parse(e.data);I(r)}catch(e){console.error("Error parsing WebSocket message:",e)}},T.current.onclose=()=>{N(!1),console.log("WebSocket disconnected"),setTimeout(R,3e3)},T.current.onerror=e=>{console.error("WebSocket error:",e),N(!1)}}catch(e){console.error("Failed to initialize WebSocket:",e),N(!1)}},I=e=>{if(console.log("WebSocket message received:",e),"connection_established"===e.type)console.log("WebSocket connection established:",e.data);else if("ai_response_chunk"===e.type)n(r=>{let t=r[r.length-1];return t&&"assistant"===t.role&&"streaming"===t.id?r.slice(0,-1).concat({...t,content:t.content+e.data.content}):[...r,{id:"streaming",role:"assistant",content:e.data.content,timestamp:new Date,type:"text"}]});else if("ai_response_complete"===e.type)n(e=>{let r=e[e.length-1];return r&&"streaming"===r.id?e.slice(0,-1).concat({...r,id:Date.now().toString()}):e}),S(!1);else if("transcription_final"===e.type){let r={id:Date.now().toString(),role:"user",content:e.data.text,timestamp:new Date,type:"audio"};n(e=>[...e,r])}else"error"===e.type&&(console.error("WebSocket error:",e.data.message),S(!1))},F=async()=>{try{let e=await fetch("/api/v1/audio/phi4/info");if(e.ok){let r=await e.json();E(r.is_loaded?"ready":r.is_loading?"loading":"error"),r.load_progress&&O({progress:100*r.load_progress.progress,message:r.load_progress.message||""}),r.is_loaded||r.is_loading||await z()}else E("error")}catch(e){console.error("Error checking Phi-4 status:",e),E("error")}},z=async()=>{try{if(E("loading"),(await fetch("/api/v1/audio/phi4/load",{method:"POST",headers:{"Content-Type":"application/json"}})).ok){let e=setInterval(async()=>{try{let t=await fetch("/api/v1/audio/phi4/info");if(t.ok){var r;let s=await t.json();s.load_progress&&O({progress:100*s.load_progress.progress,message:s.load_progress.message||""}),s.is_loaded?(E("ready"),clearInterval(e)):(null==(r=s.load_progress)?void 0:r.status)==="error"&&(E("error"),clearInterval(e))}}catch(e){console.error("Error polling Phi-4 status:",e)}},2e3);setTimeout(()=>clearInterval(e),3e5)}else E("error")}catch(e){console.error("Error loading Phi-4:",e),E("error")}},J=async()=>{if(!o.trim()||!T.current||T.current.readyState!==WebSocket.OPEN)return;let e={id:Date.now().toString(),role:"user",content:o,timestamp:new Date,type:"text"};n(r=>[...r,e]),S(!0),T.current.send(JSON.stringify({type:"chat_message",data:{content:o,conversation_id:null,model:"phi-4",temperature:.7,stream:!0}})),l("")},L=async()=>{if(i)C.current&&C.current.stop(),c(!1);else try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaRecorder(e);C.current=r;let t=[];r.ondataavailable=e=>{t.push(e.data)},r.onstop=async()=>{let r=new Blob(t,{type:"audio/webm"});await U(r),e.getTracks().forEach(e=>e.stop())},r.start(),c(!0)}catch(e){console.error("Error starting recording:",e),alert("Could not access microphone. Please check permissions.")}},U=async e=>{if(!T.current||T.current.readyState!==WebSocket.OPEN)return;S(!0);let r=new FileReader;r.onload=()=>{var e,t,s;let a=r.result.split(",")[1];null==(e=T.current)||e.send(JSON.stringify({type:"audio_start",data:{}})),null==(t=T.current)||t.send(JSON.stringify({type:"transcription_request",data:{audio_data:a,format:"webm",language:null,task:"transcribe"}})),null==(s=T.current)||s.send(JSON.stringify({type:"audio_stop",data:{}}))},r.readAsDataURL(e)},B=async()=>{if(m)P.current&&P.current.srcObject&&(P.current.srcObject.getTracks().forEach(e=>e.stop()),P.current.srcObject=null),j(!1);else try{let e=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480}});P.current&&(P.current.srcObject=e,P.current.play()),j(!0)}catch(e){console.error("Error starting camera:",e),alert("Could not access camera. Please check permissions.")}},M=async()=>{if(!P.current||!m)return;let e=document.createElement("canvas"),r=e.getContext("2d");r&&(e.width=P.current.videoWidth,e.height=P.current.videoHeight,r.drawImage(P.current,0,0),e.toBlob(async e=>{if(!e||!T.current||T.current.readyState!==WebSocket.OPEN)return;S(!0);let r=new FileReader;r.onload=()=>{var e;let t=r.result.split(",")[1],s={id:Date.now().toString(),role:"user",content:"\uD83D\uDCF8 Image captured",timestamp:new Date,type:"image"};n(e=>[...e,s]),null==(e=T.current)||e.send(JSON.stringify({type:"image_message",image_data:t,format:"png"}))},r.readAsDataURL(e)},"image/png"))},V=e=>e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return(0,s.jsxs)("div",{className:"flex flex-col h-full ".concat(r),children:[(0,s.jsxs)("div",{className:"border-b",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(f.A,{className:"h-6 w-6 text-blue-600"}),(0,s.jsx)("h1",{className:"text-xl font-semibold",children:"Tektra AI Assistant"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full ".concat("ready"===_&&w?"bg-green-500":"loading"===_?"bg-yellow-500":"bg-red-500")}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"ready"===_&&w?"Phi-4 Ready":"loading"===_?"Loading Phi-4... ".concat(A.progress.toFixed(0),"%"):"error"===_?"Phi-4 Error":"Disconnected"})]})]}),"loading"===_&&(0,s.jsxs)("div",{className:"px-4 pb-2",children:[(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(A.progress,"%")}})}),A.message&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:A.message})]})]}),(0,s.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===t.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center text-gray-500",children:[(0,s.jsx)(f.A,{className:"h-12 w-12 mb-4 text-gray-400"}),(0,s.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Welcome to Tektra AI"}),(0,s.jsx)("p",{children:"Start a conversation by typing, speaking, or taking a photo!"})]}):t.map(e=>(0,s.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:"max-w-[70%] rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:["user"===e.role?(0,s.jsx)(x.A,{className:"h-4 w-4"}):(0,s.jsx)(f.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"text-xs opacity-75",children:V(e.timestamp)}),"text"!==e.type&&(0,s.jsx)(g,{variant:"secondary",className:"text-xs",children:e.type})]}),(0,s.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.content})]})},e.id)),k&&(0,s.jsx)("div",{className:"flex justify-start",children:(0,s.jsx)("div",{className:"bg-gray-100 rounded-lg px-4 py-2",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(f.A,{className:"h-4 w-4"}),(0,s.jsxs)("div",{className:"flex space-x-1",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})}),(0,s.jsx)("div",{ref:D})]}),(0,s.jsx)("div",{className:"border-t p-4",children:(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(u,{value:o,onChange:e=>l(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),J())},placeholder:"Type your message...",className:"resize-none",rows:2})}),(0,s.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,s.jsx)(d,{onClick:J,disabled:!o.trim()||!w,size:"sm",children:(0,s.jsx)(h.A,{className:"h-4 w-4"})}),(0,s.jsx)(d,{onClick:L,variant:i?"destructive":"outline",size:"sm",disabled:!w,children:i?(0,s.jsx)(p.A,{className:"h-4 w-4"}):(0,s.jsx)(y.A,{className:"h-4 w-4"})})]})]})})]}),(0,s.jsxs)("div",{className:"w-80 border-l flex flex-col",children:[(0,s.jsx)("div",{className:"p-4 border-b",children:(0,s.jsx)("h3",{className:"font-medium",children:"Camera"})}),(0,s.jsxs)("div",{className:"flex-1 p-4",children:[(0,s.jsxs)("div",{className:"aspect-video bg-gray-100 rounded-lg overflow-hidden mb-4",children:[(0,s.jsx)("video",{ref:P,className:"w-full h-full object-cover",style:{display:m?"block":"none"}}),!m&&(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,s.jsx)(v.A,{className:"h-12 w-12 text-gray-400"})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d,{onClick:B,variant:m?"destructive":"default",className:"w-full",children:m?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Turn Off Camera"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Turn On Camera"]})}),m&&(0,s.jsxs)(d,{onClick:M,variant:"outline",className:"w-full",disabled:!w,children:[(0,s.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Take Photo"]})]})]})]})]})]})}},6778:(e,r,t)=>{Promise.resolve().then(t.bind(t,3737))}},e=>{var r=r=>e(e.s=r);e.O(0,[788,441,684,358],()=>r(6778)),_N_E=e.O()}]);