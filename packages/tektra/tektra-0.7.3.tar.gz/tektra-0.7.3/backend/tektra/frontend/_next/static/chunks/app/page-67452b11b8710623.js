(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3737:(e,t,r)=>{"use strict";r.d(t,{default:()=>j});var s=r(5155),a=r(2115),n=r(2085),i=r(2596),o=r(9688);function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.QP)((0,i.$)(t))}let c=(0,n.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:r,variant:a,size:n,...i}=e;return(0,s.jsx)("button",{className:l(c({variant:a,size:n,className:r})),ref:t,...i})});d.displayName="Button";let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("textarea",{className:l("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...a})});u.displayName="Textarea";let m=(0,n.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function f(e){let{className:t,variant:r,...a}=e;return(0,s.jsx)("div",{className:l(m({variant:r}),t),...a})}var x=r(5657),h=r(1007),g=r(2486),p=r(8979),v=r(9588),y=r(136),b=r(4355);function j(e){let{className:t}=e,[r,n]=(0,a.useState)([]),[i,o]=(0,a.useState)(""),[l,c]=(0,a.useState)(!1),[m,j]=(0,a.useState)(!1),[w,N]=(0,a.useState)(!1),[k,S]=(0,a.useState)(!1),[A,E]=(0,a.useState)("loading"),D=(0,a.useRef)(null),O=(0,a.useRef)(null),P=(0,a.useRef)(null),C=(0,a.useRef)(null),_=()=>{var e;null==(e=D.current)||e.scrollIntoView({behavior:"smooth"})};(0,a.useEffect)(()=>{_()},[r]),(0,a.useEffect)(()=>(T(),W(),()=>{C.current&&C.current.close()}),[]);let T=()=>{try{let e="https:"===window.location.protocol?"wss:":"ws:",t="".concat(e,"//").concat(window.location.host,"/ws");C.current=new WebSocket(t),C.current.onopen=()=>{N(!0),console.log("WebSocket connected")},C.current.onmessage=e=>{try{let t=JSON.parse(e.data);R(t)}catch(e){console.error("Error parsing WebSocket message:",e)}},C.current.onclose=()=>{N(!1),console.log("WebSocket disconnected"),setTimeout(T,3e3)},C.current.onerror=e=>{console.error("WebSocket error:",e),N(!1)}}catch(e){console.error("Failed to initialize WebSocket:",e),N(!1)}},R=e=>{if("chat_response"===e.type){let t={id:Date.now().toString(),role:"assistant",content:e.message,timestamp:new Date,type:"text"};n(e=>[...e,t])}else if("transcription"===e.type){let t={id:Date.now().toString(),role:"user",content:e.text,timestamp:new Date,type:"audio"};n(e=>[...e,t])}S(!1)},W=async()=>{try{let e=await fetch("/api/v1/audio/api/v1/audio/phi4/info");if(e.ok){let t=await e.json();E(t.is_loaded?"ready":"loading"),t.is_loaded||await F()}else E("error")}catch(e){console.error("Error checking Phi-4 status:",e),E("error")}},F=async()=>{try{E("loading"),(await fetch("/api/v1/audio/api/v1/audio/phi4/load",{method:"POST",headers:{"Content-Type":"application/json"}})).ok?E("ready"):E("error")}catch(e){console.error("Error loading Phi-4:",e),E("error")}},z=async()=>{if(!i.trim()||!C.current||C.current.readyState!==WebSocket.OPEN)return;let e={id:Date.now().toString(),role:"user",content:i,timestamp:new Date,type:"text"};n(t=>[...t,e]),S(!0),C.current.send(JSON.stringify({type:"chat_message",message:i,model:"phi-4"})),o("")},I=async()=>{if(l)P.current&&P.current.stop(),c(!1);else try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);P.current=t;let r=[];t.ondataavailable=e=>{r.push(e.data)},t.onstop=async()=>{let t=new Blob(r,{type:"audio/webm"});await J(t),e.getTracks().forEach(e=>e.stop())},t.start(),c(!0)}catch(e){console.error("Error starting recording:",e),alert("Could not access microphone. Please check permissions.")}},J=async e=>{if(!C.current||C.current.readyState!==WebSocket.OPEN)return;S(!0);let t=new FileReader;t.onload=()=>{var e;let r=t.result.split(",")[1];null==(e=C.current)||e.send(JSON.stringify({type:"audio_message",audio_data:r,format:"webm"}))},t.readAsDataURL(e)},L=async()=>{if(m)O.current&&O.current.srcObject&&(O.current.srcObject.getTracks().forEach(e=>e.stop()),O.current.srcObject=null),j(!1);else try{let e=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480}});O.current&&(O.current.srcObject=e,O.current.play()),j(!0)}catch(e){console.error("Error starting camera:",e),alert("Could not access camera. Please check permissions.")}},U=async()=>{if(!O.current||!m)return;let e=document.createElement("canvas"),t=e.getContext("2d");t&&(e.width=O.current.videoWidth,e.height=O.current.videoHeight,t.drawImage(O.current,0,0),e.toBlob(async e=>{if(!e||!C.current||C.current.readyState!==WebSocket.OPEN)return;S(!0);let t=new FileReader;t.onload=()=>{var e;let r=t.result.split(",")[1],s={id:Date.now().toString(),role:"user",content:"\uD83D\uDCF8 Image captured",timestamp:new Date,type:"image"};n(e=>[...e,s]),null==(e=C.current)||e.send(JSON.stringify({type:"image_message",image_data:r,format:"png"}))},t.readAsDataURL(e)},"image/png"))},B=e=>e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return(0,s.jsxs)("div",{className:"flex flex-col h-full ".concat(t),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(x.A,{className:"h-6 w-6 text-blue-600"}),(0,s.jsx)("h1",{className:"text-xl font-semibold",children:"Tektra AI Assistant"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full ".concat("ready"===A&&w?"bg-green-500":"loading"===A?"bg-yellow-500":"bg-red-500")}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"ready"===A&&w?"Phi-4 Ready":"loading"===A?"Loading Phi-4...":"error"===A?"Phi-4 Error":"Disconnected"})]})]}),(0,s.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===r.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center text-gray-500",children:[(0,s.jsx)(x.A,{className:"h-12 w-12 mb-4 text-gray-400"}),(0,s.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Welcome to Tektra AI"}),(0,s.jsx)("p",{children:"Start a conversation by typing, speaking, or taking a photo!"})]}):r.map(e=>(0,s.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:"max-w-[70%] rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:["user"===e.role?(0,s.jsx)(h.A,{className:"h-4 w-4"}):(0,s.jsx)(x.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"text-xs opacity-75",children:B(e.timestamp)}),"text"!==e.type&&(0,s.jsx)(f,{variant:"secondary",className:"text-xs",children:e.type})]}),(0,s.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.content})]})},e.id)),k&&(0,s.jsx)("div",{className:"flex justify-start",children:(0,s.jsx)("div",{className:"bg-gray-100 rounded-lg px-4 py-2",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(x.A,{className:"h-4 w-4"}),(0,s.jsxs)("div",{className:"flex space-x-1",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})}),(0,s.jsx)("div",{ref:D})]}),(0,s.jsx)("div",{className:"border-t p-4",children:(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(u,{value:i,onChange:e=>o(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),z())},placeholder:"Type your message...",className:"resize-none",rows:2})}),(0,s.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,s.jsx)(d,{onClick:z,disabled:!i.trim()||!w,size:"sm",children:(0,s.jsx)(g.A,{className:"h-4 w-4"})}),(0,s.jsx)(d,{onClick:I,variant:l?"destructive":"outline",size:"sm",disabled:!w,children:l?(0,s.jsx)(p.A,{className:"h-4 w-4"}):(0,s.jsx)(v.A,{className:"h-4 w-4"})})]})]})})]}),(0,s.jsxs)("div",{className:"w-80 border-l flex flex-col",children:[(0,s.jsx)("div",{className:"p-4 border-b",children:(0,s.jsx)("h3",{className:"font-medium",children:"Camera"})}),(0,s.jsxs)("div",{className:"flex-1 p-4",children:[(0,s.jsxs)("div",{className:"aspect-video bg-gray-100 rounded-lg overflow-hidden mb-4",children:[(0,s.jsx)("video",{ref:O,className:"w-full h-full object-cover",style:{display:m?"block":"none"}}),!m&&(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,s.jsx)(y.A,{className:"h-12 w-12 text-gray-400"})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d,{onClick:L,variant:m?"destructive":"default",className:"w-full",children:m?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.A,{className:"h-4 w-4 mr-2"}),"Turn Off Camera"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Turn On Camera"]})}),m&&(0,s.jsxs)(d,{onClick:U,variant:"outline",className:"w-full",disabled:!w,children:[(0,s.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Take Photo"]})]})]})]})]})]})}},6778:(e,t,r)=>{Promise.resolve().then(r.bind(r,3737))}},e=>{var t=t=>e(e.s=t);e.O(0,[788,441,684,358],()=>t(6778)),_N_E=e.O()}]);